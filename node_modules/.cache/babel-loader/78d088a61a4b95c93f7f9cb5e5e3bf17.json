{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport partition from 'lodash/partition';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\nimport { getListeners } from '../../_util/props-util';\nvar upLoadPropTypes = {\n  componentTag: PropTypes.string,\n  // style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  name: PropTypes.string,\n  // className: PropTypes.string,\n  multiple: PropTypes.bool,\n  directory: PropTypes.bool,\n  disabled: PropTypes.bool,\n  accept: PropTypes.string,\n  // children: PropTypes.any,\n  // onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  // onProgress: PropTypes.func,\n  withCredentials: PropTypes.bool,\n  openFileDialogOnClick: PropTypes.bool,\n  transformFile: PropTypes.func,\n  method: PropTypes.string\n};\nvar AjaxUploader = {\n  inheritAttrs: false,\n  name: 'ajaxUploader',\n  mixins: [BaseMixin],\n  props: upLoadPropTypes,\n  data: function data() {\n    this.reqs = {};\n    return {\n      uid: getUid()\n    };\n  },\n  mounted: function mounted() {\n    this._isMounted = true;\n  },\n  beforeDestroy: function beforeDestroy() {\n    this._isMounted = false;\n    this.abort();\n  },\n  methods: {\n    onChange: function onChange(e) {\n      var files = e.target.files;\n      this.uploadFiles(files);\n      this.reset();\n    },\n    onClick: function onClick() {\n      var el = this.$refs.fileInputRef;\n\n      if (!el) {\n        return;\n      }\n\n      el.click();\n    },\n    onKeyDown: function onKeyDown(e) {\n      if (e.key === 'Enter') {\n        this.onClick();\n      }\n    },\n    onFileDrop: function onFileDrop(e) {\n      var _this = this;\n\n      var multiple = this.$props.multiple;\n      e.preventDefault();\n\n      if (e.type === 'dragover') {\n        return;\n      }\n\n      if (this.directory) {\n        traverseFileTree(e.dataTransfer.items, this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.accept);\n        });\n      } else {\n        var files = partition(Array.prototype.slice.call(e.dataTransfer.files), function (file) {\n          return attrAccept(file, _this.accept);\n        });\n        var successFiles = files[0];\n        var errorFiles = files[1];\n\n        if (multiple === false) {\n          successFiles = successFiles.slice(0, 1);\n        }\n\n        this.uploadFiles(successFiles);\n\n        if (errorFiles.length) {\n          this.$emit('reject', errorFiles);\n        }\n      }\n    },\n    uploadFiles: function uploadFiles(files) {\n      var _this2 = this;\n\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.map(function (file) {\n        file.uid = getUid();\n        return file;\n      }).forEach(function (file) {\n        _this2.upload(file, postFiles);\n      });\n    },\n    upload: function upload(file, fileList) {\n      var _this3 = this;\n\n      if (!this.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n\n      var before = this.beforeUpload(file, fileList);\n\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this3.post(processedFile);\n          }\n\n          return _this3.post(file);\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n    },\n    post: function post(file) {\n      var _this4 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n\n      var props = this.$props;\n      var data = props.data;\n      var _props$transformFile = props.transformFile,\n          transformFile = _props$transformFile === undefined ? function (originFile) {\n        return originFile;\n      } : _props$transformFile;\n      new Promise(function (resolve) {\n        var action = _this4.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n        var request = _this4.customRequest || defaultRequest;\n        var transform = Promise.resolve(transformFile(file))['catch'](function (e) {\n          console.error(e); // eslint-disable-line no-console\n        });\n        transform.then(function (transformedFile) {\n          if (typeof data === 'function') {\n            data = data(file);\n          }\n\n          var requestOption = {\n            action: action,\n            filename: _this4.name,\n            data: data,\n            file: transformedFile,\n            headers: _this4.headers,\n            withCredentials: _this4.withCredentials,\n            method: props.method || 'post',\n            onProgress: function onProgress(e) {\n              _this4.$emit('progress', e, file);\n            },\n            onSuccess: function onSuccess(ret, xhr) {\n              delete _this4.reqs[uid];\n\n              _this4.$emit('success', ret, file, xhr);\n            },\n            onError: function onError(err, ret) {\n              delete _this4.reqs[uid];\n\n              _this4.$emit('error', err, ret, file);\n            }\n          };\n          _this4.reqs[uid] = request(requestOption);\n\n          _this4.$emit('start', file);\n        });\n      });\n    },\n    reset: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    },\n    abort: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (reqs[uid] && reqs[uid].abort) {\n          reqs[uid].abort();\n        }\n\n        delete reqs[uid];\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid] && reqs[uid].abort) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  },\n  render: function render() {\n    var _classNames;\n\n    var h = arguments[0];\n    var $props = this.$props,\n        $attrs = this.$attrs;\n    var Tag = $props.componentTag,\n        prefixCls = $props.prefixCls,\n        disabled = $props.disabled,\n        multiple = $props.multiple,\n        accept = $props.accept,\n        directory = $props.directory,\n        openFileDialogOnClick = $props.openFileDialogOnClick;\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _classNames));\n    var events = disabled ? {} : {\n      click: openFileDialogOnClick ? this.onClick : function () {},\n      keydown: openFileDialogOnClick ? this.onKeyDown : function () {},\n      drop: this.onFileDrop,\n      dragover: this.onFileDrop\n    };\n    var tagProps = {\n      on: _extends({}, getListeners(this), events),\n      attrs: {\n        role: 'button',\n        tabIndex: disabled ? null : '0'\n      },\n      'class': cls\n    };\n    return h(Tag, tagProps, [h('input', {\n      attrs: {\n        id: $attrs.id,\n        type: 'file',\n        accept: accept,\n        directory: directory ? 'directory' : null,\n        webkitdirectory: directory ? 'webkitdirectory' : null,\n        multiple: multiple\n      },\n      ref: 'fileInputRef',\n      on: {\n        'click': function click(e) {\n          return e.stopPropagation();\n        },\n        'change': this.onChange\n      },\n      // https://github.com/ant-design/ant-design/issues/19948\n      key: this.uid,\n      style: {\n        display: 'none'\n      }\n    }), this.$slots['default']]);\n  }\n};\nexport default AjaxUploader;","map":{"version":3,"sources":["/Users/liulu/刘璐/vue3/hello-vue3/node_modules/ant-design-vue/es/vc-upload/src/AjaxUploader.js"],"names":["_extends","_defineProperty","PropTypes","BaseMixin","partition","classNames","defaultRequest","getUid","attrAccept","traverseFileTree","getListeners","upLoadPropTypes","componentTag","string","prefixCls","name","multiple","bool","directory","disabled","accept","data","oneOfType","object","func","action","headers","beforeUpload","customRequest","withCredentials","openFileDialogOnClick","transformFile","method","AjaxUploader","inheritAttrs","mixins","props","reqs","uid","mounted","_isMounted","beforeDestroy","abort","methods","onChange","e","files","target","uploadFiles","reset","onClick","el","$refs","fileInputRef","click","onKeyDown","key","onFileDrop","_this","$props","preventDefault","type","dataTransfer","items","_file","Array","prototype","slice","call","file","successFiles","errorFiles","length","$emit","_this2","postFiles","map","forEach","upload","fileList","_this3","setTimeout","post","before","then","processedFile","processedFileType","Object","toString","console","log","_this4","_props$transformFile","undefined","originFile","Promise","resolve","request","transform","error","transformedFile","requestOption","filename","onProgress","onSuccess","ret","xhr","onError","err","setState","keys","render","_classNames","h","arguments","$attrs","Tag","cls","events","keydown","drop","dragover","tagProps","on","attrs","role","tabIndex","id","webkitdirectory","ref","stopPropagation","style","display","$slots"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport partition from 'lodash/partition';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\nimport { getListeners } from '../../_util/props-util';\n\nvar upLoadPropTypes = {\n  componentTag: PropTypes.string,\n  // style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  name: PropTypes.string,\n  // className: PropTypes.string,\n  multiple: PropTypes.bool,\n  directory: PropTypes.bool,\n  disabled: PropTypes.bool,\n  accept: PropTypes.string,\n  // children: PropTypes.any,\n  // onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  // onProgress: PropTypes.func,\n  withCredentials: PropTypes.bool,\n  openFileDialogOnClick: PropTypes.bool,\n  transformFile: PropTypes.func,\n  method: PropTypes.string\n};\n\nvar AjaxUploader = {\n  inheritAttrs: false,\n  name: 'ajaxUploader',\n  mixins: [BaseMixin],\n  props: upLoadPropTypes,\n  data: function data() {\n    this.reqs = {};\n    return {\n      uid: getUid()\n    };\n  },\n  mounted: function mounted() {\n    this._isMounted = true;\n  },\n  beforeDestroy: function beforeDestroy() {\n    this._isMounted = false;\n    this.abort();\n  },\n\n  methods: {\n    onChange: function onChange(e) {\n      var files = e.target.files;\n      this.uploadFiles(files);\n      this.reset();\n    },\n    onClick: function onClick() {\n      var el = this.$refs.fileInputRef;\n      if (!el) {\n        return;\n      }\n      el.click();\n    },\n    onKeyDown: function onKeyDown(e) {\n      if (e.key === 'Enter') {\n        this.onClick();\n      }\n    },\n    onFileDrop: function onFileDrop(e) {\n      var _this = this;\n\n      var multiple = this.$props.multiple;\n\n      e.preventDefault();\n      if (e.type === 'dragover') {\n        return;\n      }\n      if (this.directory) {\n        traverseFileTree(e.dataTransfer.items, this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.accept);\n        });\n      } else {\n        var files = partition(Array.prototype.slice.call(e.dataTransfer.files), function (file) {\n          return attrAccept(file, _this.accept);\n        });\n        var successFiles = files[0];\n        var errorFiles = files[1];\n        if (multiple === false) {\n          successFiles = successFiles.slice(0, 1);\n        }\n        this.uploadFiles(successFiles);\n\n        if (errorFiles.length) {\n          this.$emit('reject', errorFiles);\n        }\n      }\n    },\n    uploadFiles: function uploadFiles(files) {\n      var _this2 = this;\n\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.map(function (file) {\n        file.uid = getUid();\n        return file;\n      }).forEach(function (file) {\n        _this2.upload(file, postFiles);\n      });\n    },\n    upload: function upload(file, fileList) {\n      var _this3 = this;\n\n      if (!this.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n\n      var before = this.beforeUpload(file, fileList);\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this3.post(processedFile);\n          }\n          return _this3.post(file);\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n    },\n    post: function post(file) {\n      var _this4 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n      var props = this.$props;\n      var data = props.data;\n      var _props$transformFile = props.transformFile,\n          transformFile = _props$transformFile === undefined ? function (originFile) {\n        return originFile;\n      } : _props$transformFile;\n\n\n      new Promise(function (resolve) {\n        var action = _this4.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n\n        var request = _this4.customRequest || defaultRequest;\n        var transform = Promise.resolve(transformFile(file))['catch'](function (e) {\n          console.error(e); // eslint-disable-line no-console\n        });\n        transform.then(function (transformedFile) {\n          if (typeof data === 'function') {\n            data = data(file);\n          }\n\n          var requestOption = {\n            action: action,\n            filename: _this4.name,\n            data: data,\n            file: transformedFile,\n            headers: _this4.headers,\n            withCredentials: _this4.withCredentials,\n            method: props.method || 'post',\n            onProgress: function onProgress(e) {\n              _this4.$emit('progress', e, file);\n            },\n            onSuccess: function onSuccess(ret, xhr) {\n              delete _this4.reqs[uid];\n              _this4.$emit('success', ret, file, xhr);\n            },\n            onError: function onError(err, ret) {\n              delete _this4.reqs[uid];\n              _this4.$emit('error', err, ret, file);\n            }\n          };\n          _this4.reqs[uid] = request(requestOption);\n          _this4.$emit('start', file);\n        });\n      });\n    },\n    reset: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    },\n    abort: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n        if (reqs[uid] && reqs[uid].abort) {\n          reqs[uid].abort();\n        }\n        delete reqs[uid];\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid] && reqs[uid].abort) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  },\n\n  render: function render() {\n    var _classNames;\n\n    var h = arguments[0];\n    var $props = this.$props,\n        $attrs = this.$attrs;\n    var Tag = $props.componentTag,\n        prefixCls = $props.prefixCls,\n        disabled = $props.disabled,\n        multiple = $props.multiple,\n        accept = $props.accept,\n        directory = $props.directory,\n        openFileDialogOnClick = $props.openFileDialogOnClick;\n\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _classNames));\n    var events = disabled ? {} : {\n      click: openFileDialogOnClick ? this.onClick : function () {},\n      keydown: openFileDialogOnClick ? this.onKeyDown : function () {},\n      drop: this.onFileDrop,\n      dragover: this.onFileDrop\n    };\n    var tagProps = {\n      on: _extends({}, getListeners(this), events),\n      attrs: {\n        role: 'button',\n        tabIndex: disabled ? null : '0'\n      },\n      'class': cls\n    };\n    return h(\n      Tag,\n      tagProps,\n      [h('input', {\n        attrs: {\n          id: $attrs.id,\n          type: 'file',\n\n          accept: accept,\n          directory: directory ? 'directory' : null,\n          webkitdirectory: directory ? 'webkitdirectory' : null,\n          multiple: multiple\n        },\n        ref: 'fileInputRef',\n        on: {\n          'click': function click(e) {\n            return e.stopPropagation();\n          },\n          'change': this.onChange\n        },\n        // https://github.com/ant-design/ant-design/issues/19948\n        key: this.uid,\n        style: { display: 'none' } }), this.$slots['default']]\n    );\n  }\n};\n\nexport default AjaxUploader;"]},"metadata":{},"sourceType":"module"}