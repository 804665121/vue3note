{"ast":null,"code":"import _toConsumableArray from 'babel-runtime/helpers/toConsumableArray';\nimport _extends from 'babel-runtime/helpers/extends';\nimport warning from 'warning';\nimport PropTypes from '../../../_util/vue-types';\nimport { Tree } from '../../../vc-tree';\nimport BaseMixin from '../../../_util/BaseMixin';\nimport { createRef } from '../util'; // export const popupContextTypes = {\n//   onPopupKeyDown: PropTypes.func.isRequired,\n//   onTreeNodeSelect: PropTypes.func.isRequired,\n//   onTreeNodeCheck: PropTypes.func.isRequired,\n// }\n\nfunction getDerivedState(nextProps, prevState) {\n  var _ref = prevState || {},\n      _ref$_prevProps = _ref._prevProps,\n      prevProps = _ref$_prevProps === undefined ? {} : _ref$_prevProps,\n      loadedKeys = _ref._loadedKeys,\n      expandedKeyList = _ref._expandedKeyList,\n      cachedExpandedKeyList = _ref._cachedExpandedKeyList;\n\n  var valueList = nextProps.valueList,\n      valueEntities = nextProps.valueEntities,\n      keyEntities = nextProps.keyEntities,\n      treeExpandedKeys = nextProps.treeExpandedKeys,\n      filteredTreeNodes = nextProps.filteredTreeNodes,\n      upperSearchValue = nextProps.upperSearchValue;\n  var newState = {\n    _prevProps: _extends({}, nextProps)\n  }; // Check value update\n\n  if (valueList !== prevProps.valueList) {\n    newState._keyList = valueList.map(function (_ref2) {\n      var value = _ref2.value;\n      return valueEntities[value];\n    }).filter(function (entity) {\n      return entity;\n    }).map(function (_ref3) {\n      var key = _ref3.key;\n      return key;\n    });\n  } // Show all when tree is in filter mode\n\n\n  if (!treeExpandedKeys && filteredTreeNodes && filteredTreeNodes.length && filteredTreeNodes !== prevProps.filteredTreeNodes) {\n    newState._expandedKeyList = [].concat(_toConsumableArray(keyEntities.keys()));\n  } // Cache `expandedKeyList` when filter set\n\n\n  if (upperSearchValue && !prevProps.upperSearchValue) {\n    newState._cachedExpandedKeyList = expandedKeyList;\n  } else if (!upperSearchValue && prevProps.upperSearchValue && !treeExpandedKeys) {\n    newState._expandedKeyList = cachedExpandedKeyList || [];\n    newState._cachedExpandedKeyList = [];\n  } // Use expandedKeys if provided\n\n\n  if (prevProps.treeExpandedKeys !== treeExpandedKeys) {\n    newState._expandedKeyList = treeExpandedKeys;\n  } // Clean loadedKeys if key not exist in keyEntities anymore\n\n\n  if (nextProps.loadData) {\n    newState._loadedKeys = loadedKeys.filter(function (key) {\n      return keyEntities.has(key);\n    });\n  }\n\n  return newState;\n}\n\nvar BasePopup = {\n  mixins: [BaseMixin],\n  name: 'BasePopup',\n  props: {\n    prefixCls: PropTypes.string,\n    upperSearchValue: PropTypes.string,\n    valueList: PropTypes.array,\n    searchHalfCheckedKeys: PropTypes.array,\n    valueEntities: PropTypes.object,\n    keyEntities: Map,\n    treeIcon: PropTypes.bool,\n    treeLine: PropTypes.bool,\n    treeNodeFilterProp: PropTypes.string,\n    treeCheckable: PropTypes.any,\n    treeCheckStrictly: PropTypes.bool,\n    treeDefaultExpandAll: PropTypes.bool,\n    treeDefaultExpandedKeys: PropTypes.array,\n    treeExpandedKeys: PropTypes.array,\n    loadData: PropTypes.func,\n    multiple: PropTypes.bool,\n    // onTreeExpand: PropTypes.func,\n    searchValue: PropTypes.string,\n    treeNodes: PropTypes.any,\n    filteredTreeNodes: PropTypes.any,\n    notFoundContent: PropTypes.any,\n    ariaId: PropTypes.string,\n    switcherIcon: PropTypes.any,\n    // HOC\n    renderSearch: PropTypes.func,\n    // onTreeExpanded: PropTypes.func,\n    __propsSymbol__: PropTypes.any\n  },\n  inject: {\n    vcTreeSelect: {\n      'default': function _default() {\n        return {};\n      }\n    }\n  },\n  watch: {\n    __propsSymbol__: function __propsSymbol__() {\n      var state = getDerivedState(this.$props, this.$data);\n      this.setState(state);\n    }\n  },\n  data: function data() {\n    this.treeRef = createRef();\n    warning(this.$props.__propsSymbol__, 'must pass __propsSymbol__');\n    var _$props = this.$props,\n        treeDefaultExpandAll = _$props.treeDefaultExpandAll,\n        treeDefaultExpandedKeys = _$props.treeDefaultExpandedKeys,\n        keyEntities = _$props.keyEntities; // TODO: make `expandedKeyList` control\n\n    var expandedKeyList = treeDefaultExpandedKeys;\n\n    if (treeDefaultExpandAll) {\n      expandedKeyList = [].concat(_toConsumableArray(keyEntities.keys()));\n    }\n\n    var state = {\n      _keyList: [],\n      _expandedKeyList: expandedKeyList,\n      // Cache `expandedKeyList` when tree is in filter. This is used in `getDerivedState`\n      _cachedExpandedKeyList: [],\n      _loadedKeys: [],\n      _prevProps: {}\n    };\n    return _extends({}, state, getDerivedState(this.$props, state));\n  },\n  methods: {\n    onTreeExpand: function onTreeExpand(expandedKeyList) {\n      var _this = this;\n\n      var treeExpandedKeys = this.$props.treeExpandedKeys; // Set uncontrolled state\n\n      if (!treeExpandedKeys) {\n        this.setState({\n          _expandedKeyList: expandedKeyList\n        }, function () {\n          _this.__emit('treeExpanded');\n        });\n      }\n\n      this.__emit('update:treeExpandedKeys', expandedKeyList);\n\n      this.__emit('treeExpand', expandedKeyList);\n    },\n    onLoad: function onLoad(loadedKeys) {\n      this.setState({\n        _loadedKeys: loadedKeys\n      });\n    },\n    getTree: function getTree() {\n      return this.treeRef.current;\n    },\n\n    /**\n     * Not pass `loadData` when searching. To avoid loop ajax call makes browser crash.\n     */\n    getLoadData: function getLoadData() {\n      var _$props2 = this.$props,\n          loadData = _$props2.loadData,\n          upperSearchValue = _$props2.upperSearchValue;\n      if (upperSearchValue) return null;\n      return loadData;\n    },\n\n    /**\n     * This method pass to Tree component which is used for add filtered class\n     * in TreeNode > li\n     */\n    filterTreeNode: function filterTreeNode(treeNode) {\n      var _$props3 = this.$props,\n          upperSearchValue = _$props3.upperSearchValue,\n          treeNodeFilterProp = _$props3.treeNodeFilterProp;\n      var filterVal = treeNode[treeNodeFilterProp];\n\n      if (typeof filterVal === 'string') {\n        return upperSearchValue && filterVal.toUpperCase().indexOf(upperSearchValue) !== -1;\n      }\n\n      return false;\n    },\n    renderNotFound: function renderNotFound() {\n      var h = this.$createElement;\n      var _$props4 = this.$props,\n          prefixCls = _$props4.prefixCls,\n          notFoundContent = _$props4.notFoundContent;\n      return h('span', {\n        'class': prefixCls + '-not-found'\n      }, [notFoundContent]);\n    }\n  },\n  render: function render() {\n    var h = arguments[0];\n    var _$data = this.$data,\n        keyList = _$data._keyList,\n        expandedKeyList = _$data._expandedKeyList,\n        loadedKeys = _$data._loadedKeys;\n    var _$props5 = this.$props,\n        prefixCls = _$props5.prefixCls,\n        treeNodes = _$props5.treeNodes,\n        filteredTreeNodes = _$props5.filteredTreeNodes,\n        treeIcon = _$props5.treeIcon,\n        treeLine = _$props5.treeLine,\n        treeCheckable = _$props5.treeCheckable,\n        treeCheckStrictly = _$props5.treeCheckStrictly,\n        multiple = _$props5.multiple,\n        ariaId = _$props5.ariaId,\n        renderSearch = _$props5.renderSearch,\n        switcherIcon = _$props5.switcherIcon,\n        searchHalfCheckedKeys = _$props5.searchHalfCheckedKeys;\n    var _vcTreeSelect = this.vcTreeSelect,\n        onPopupKeyDown = _vcTreeSelect.onPopupKeyDown,\n        onTreeNodeSelect = _vcTreeSelect.onTreeNodeSelect,\n        onTreeNodeCheck = _vcTreeSelect.onTreeNodeCheck;\n    var loadData = this.getLoadData();\n    var treeProps = {};\n\n    if (treeCheckable) {\n      treeProps.checkedKeys = keyList;\n    } else {\n      treeProps.selectedKeys = keyList;\n    }\n\n    var $notFound = void 0;\n    var $treeNodes = void 0;\n\n    if (filteredTreeNodes) {\n      if (filteredTreeNodes.length) {\n        treeProps.checkStrictly = true;\n        $treeNodes = filteredTreeNodes; // Fill halfCheckedKeys\n\n        if (treeCheckable && !treeCheckStrictly) {\n          treeProps.checkedKeys = {\n            checked: keyList,\n            halfChecked: searchHalfCheckedKeys\n          };\n        }\n      } else {\n        $notFound = this.renderNotFound();\n      }\n    } else if (!treeNodes || !treeNodes.length) {\n      $notFound = this.renderNotFound();\n    } else {\n      $treeNodes = treeNodes;\n    }\n\n    var $tree = void 0;\n\n    if ($notFound) {\n      $tree = $notFound;\n    } else {\n      var treeAllProps = {\n        props: _extends({\n          prefixCls: prefixCls + '-tree',\n          showIcon: treeIcon,\n          showLine: treeLine,\n          selectable: !treeCheckable,\n          checkable: treeCheckable,\n          checkStrictly: treeCheckStrictly,\n          multiple: multiple,\n          loadData: loadData,\n          loadedKeys: loadedKeys,\n          expandedKeys: expandedKeyList,\n          filterTreeNode: this.filterTreeNode,\n          switcherIcon: switcherIcon\n        }, treeProps, {\n          __propsSymbol__: Symbol(),\n          children: $treeNodes\n        }),\n        on: {\n          select: onTreeNodeSelect,\n          check: onTreeNodeCheck,\n          expand: this.onTreeExpand,\n          load: this.onLoad\n        },\n        directives: [{\n          name: 'ant-ref',\n          value: this.treeRef\n        }]\n      };\n      $tree = h(Tree, treeAllProps);\n    }\n\n    return h('div', {\n      attrs: {\n        role: 'listbox',\n        id: ariaId,\n        tabIndex: -1\n      },\n      on: {\n        'keydown': onPopupKeyDown\n      }\n    }, [renderSearch ? renderSearch() : null, $tree]);\n  }\n};\nexport default BasePopup;","map":{"version":3,"sources":["/Users/liulu/刘璐/vue3/hello-vue3/node_modules/ant-design-vue/es/vc-tree-select/src/Base/BasePopup.js"],"names":["_toConsumableArray","_extends","warning","PropTypes","Tree","BaseMixin","createRef","getDerivedState","nextProps","prevState","_ref","_ref$_prevProps","_prevProps","prevProps","undefined","loadedKeys","_loadedKeys","expandedKeyList","_expandedKeyList","cachedExpandedKeyList","_cachedExpandedKeyList","valueList","valueEntities","keyEntities","treeExpandedKeys","filteredTreeNodes","upperSearchValue","newState","_keyList","map","_ref2","value","filter","entity","_ref3","key","length","concat","keys","loadData","has","BasePopup","mixins","name","props","prefixCls","string","array","searchHalfCheckedKeys","object","Map","treeIcon","bool","treeLine","treeNodeFilterProp","treeCheckable","any","treeCheckStrictly","treeDefaultExpandAll","treeDefaultExpandedKeys","func","multiple","searchValue","treeNodes","notFoundContent","ariaId","switcherIcon","renderSearch","__propsSymbol__","inject","vcTreeSelect","_default","watch","state","$props","$data","setState","data","treeRef","_$props","methods","onTreeExpand","_this","__emit","onLoad","getTree","current","getLoadData","_$props2","filterTreeNode","treeNode","_$props3","filterVal","toUpperCase","indexOf","renderNotFound","h","$createElement","_$props4","render","arguments","_$data","keyList","_$props5","_vcTreeSelect","onPopupKeyDown","onTreeNodeSelect","onTreeNodeCheck","treeProps","checkedKeys","selectedKeys","$notFound","$treeNodes","checkStrictly","checked","halfChecked","$tree","treeAllProps","showIcon","showLine","selectable","checkable","expandedKeys","Symbol","children","on","select","check","expand","load","directives","attrs","role","id","tabIndex"],"mappings":"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","sourcesContent":["import _toConsumableArray from 'babel-runtime/helpers/toConsumableArray';\nimport _extends from 'babel-runtime/helpers/extends';\nimport warning from 'warning';\nimport PropTypes from '../../../_util/vue-types';\nimport { Tree } from '../../../vc-tree';\nimport BaseMixin from '../../../_util/BaseMixin';\nimport { createRef } from '../util';\n\n// export const popupContextTypes = {\n//   onPopupKeyDown: PropTypes.func.isRequired,\n//   onTreeNodeSelect: PropTypes.func.isRequired,\n//   onTreeNodeCheck: PropTypes.func.isRequired,\n// }\nfunction getDerivedState(nextProps, prevState) {\n  var _ref = prevState || {},\n      _ref$_prevProps = _ref._prevProps,\n      prevProps = _ref$_prevProps === undefined ? {} : _ref$_prevProps,\n      loadedKeys = _ref._loadedKeys,\n      expandedKeyList = _ref._expandedKeyList,\n      cachedExpandedKeyList = _ref._cachedExpandedKeyList;\n\n  var valueList = nextProps.valueList,\n      valueEntities = nextProps.valueEntities,\n      keyEntities = nextProps.keyEntities,\n      treeExpandedKeys = nextProps.treeExpandedKeys,\n      filteredTreeNodes = nextProps.filteredTreeNodes,\n      upperSearchValue = nextProps.upperSearchValue;\n\n\n  var newState = {\n    _prevProps: _extends({}, nextProps)\n  };\n\n  // Check value update\n  if (valueList !== prevProps.valueList) {\n    newState._keyList = valueList.map(function (_ref2) {\n      var value = _ref2.value;\n      return valueEntities[value];\n    }).filter(function (entity) {\n      return entity;\n    }).map(function (_ref3) {\n      var key = _ref3.key;\n      return key;\n    });\n  }\n\n  // Show all when tree is in filter mode\n  if (!treeExpandedKeys && filteredTreeNodes && filteredTreeNodes.length && filteredTreeNodes !== prevProps.filteredTreeNodes) {\n    newState._expandedKeyList = [].concat(_toConsumableArray(keyEntities.keys()));\n  }\n\n  // Cache `expandedKeyList` when filter set\n  if (upperSearchValue && !prevProps.upperSearchValue) {\n    newState._cachedExpandedKeyList = expandedKeyList;\n  } else if (!upperSearchValue && prevProps.upperSearchValue && !treeExpandedKeys) {\n    newState._expandedKeyList = cachedExpandedKeyList || [];\n    newState._cachedExpandedKeyList = [];\n  }\n\n  // Use expandedKeys if provided\n  if (prevProps.treeExpandedKeys !== treeExpandedKeys) {\n    newState._expandedKeyList = treeExpandedKeys;\n  }\n\n  // Clean loadedKeys if key not exist in keyEntities anymore\n  if (nextProps.loadData) {\n    newState._loadedKeys = loadedKeys.filter(function (key) {\n      return keyEntities.has(key);\n    });\n  }\n\n  return newState;\n}\nvar BasePopup = {\n  mixins: [BaseMixin],\n  name: 'BasePopup',\n  props: {\n    prefixCls: PropTypes.string,\n    upperSearchValue: PropTypes.string,\n    valueList: PropTypes.array,\n    searchHalfCheckedKeys: PropTypes.array,\n    valueEntities: PropTypes.object,\n    keyEntities: Map,\n    treeIcon: PropTypes.bool,\n    treeLine: PropTypes.bool,\n    treeNodeFilterProp: PropTypes.string,\n    treeCheckable: PropTypes.any,\n    treeCheckStrictly: PropTypes.bool,\n    treeDefaultExpandAll: PropTypes.bool,\n    treeDefaultExpandedKeys: PropTypes.array,\n    treeExpandedKeys: PropTypes.array,\n    loadData: PropTypes.func,\n    multiple: PropTypes.bool,\n    // onTreeExpand: PropTypes.func,\n    searchValue: PropTypes.string,\n    treeNodes: PropTypes.any,\n    filteredTreeNodes: PropTypes.any,\n    notFoundContent: PropTypes.any,\n\n    ariaId: PropTypes.string,\n    switcherIcon: PropTypes.any,\n    // HOC\n    renderSearch: PropTypes.func,\n    // onTreeExpanded: PropTypes.func,\n\n    __propsSymbol__: PropTypes.any\n  },\n  inject: {\n    vcTreeSelect: { 'default': function _default() {\n        return {};\n      } }\n  },\n  watch: {\n    __propsSymbol__: function __propsSymbol__() {\n      var state = getDerivedState(this.$props, this.$data);\n      this.setState(state);\n    }\n  },\n  data: function data() {\n    this.treeRef = createRef();\n    warning(this.$props.__propsSymbol__, 'must pass __propsSymbol__');\n    var _$props = this.$props,\n        treeDefaultExpandAll = _$props.treeDefaultExpandAll,\n        treeDefaultExpandedKeys = _$props.treeDefaultExpandedKeys,\n        keyEntities = _$props.keyEntities;\n\n    // TODO: make `expandedKeyList` control\n\n    var expandedKeyList = treeDefaultExpandedKeys;\n    if (treeDefaultExpandAll) {\n      expandedKeyList = [].concat(_toConsumableArray(keyEntities.keys()));\n    }\n\n    var state = {\n      _keyList: [],\n      _expandedKeyList: expandedKeyList,\n      // Cache `expandedKeyList` when tree is in filter. This is used in `getDerivedState`\n      _cachedExpandedKeyList: [],\n      _loadedKeys: [],\n      _prevProps: {}\n    };\n    return _extends({}, state, getDerivedState(this.$props, state));\n  },\n\n  methods: {\n    onTreeExpand: function onTreeExpand(expandedKeyList) {\n      var _this = this;\n\n      var treeExpandedKeys = this.$props.treeExpandedKeys;\n\n      // Set uncontrolled state\n\n      if (!treeExpandedKeys) {\n        this.setState({ _expandedKeyList: expandedKeyList }, function () {\n          _this.__emit('treeExpanded');\n        });\n      }\n      this.__emit('update:treeExpandedKeys', expandedKeyList);\n      this.__emit('treeExpand', expandedKeyList);\n    },\n    onLoad: function onLoad(loadedKeys) {\n      this.setState({ _loadedKeys: loadedKeys });\n    },\n    getTree: function getTree() {\n      return this.treeRef.current;\n    },\n\n\n    /**\n     * Not pass `loadData` when searching. To avoid loop ajax call makes browser crash.\n     */\n    getLoadData: function getLoadData() {\n      var _$props2 = this.$props,\n          loadData = _$props2.loadData,\n          upperSearchValue = _$props2.upperSearchValue;\n\n      if (upperSearchValue) return null;\n      return loadData;\n    },\n\n\n    /**\n     * This method pass to Tree component which is used for add filtered class\n     * in TreeNode > li\n     */\n    filterTreeNode: function filterTreeNode(treeNode) {\n      var _$props3 = this.$props,\n          upperSearchValue = _$props3.upperSearchValue,\n          treeNodeFilterProp = _$props3.treeNodeFilterProp;\n\n\n      var filterVal = treeNode[treeNodeFilterProp];\n      if (typeof filterVal === 'string') {\n        return upperSearchValue && filterVal.toUpperCase().indexOf(upperSearchValue) !== -1;\n      }\n\n      return false;\n    },\n    renderNotFound: function renderNotFound() {\n      var h = this.$createElement;\n      var _$props4 = this.$props,\n          prefixCls = _$props4.prefixCls,\n          notFoundContent = _$props4.notFoundContent;\n\n\n      return h(\n        'span',\n        { 'class': prefixCls + '-not-found' },\n        [notFoundContent]\n      );\n    }\n  },\n\n  render: function render() {\n    var h = arguments[0];\n    var _$data = this.$data,\n        keyList = _$data._keyList,\n        expandedKeyList = _$data._expandedKeyList,\n        loadedKeys = _$data._loadedKeys;\n    var _$props5 = this.$props,\n        prefixCls = _$props5.prefixCls,\n        treeNodes = _$props5.treeNodes,\n        filteredTreeNodes = _$props5.filteredTreeNodes,\n        treeIcon = _$props5.treeIcon,\n        treeLine = _$props5.treeLine,\n        treeCheckable = _$props5.treeCheckable,\n        treeCheckStrictly = _$props5.treeCheckStrictly,\n        multiple = _$props5.multiple,\n        ariaId = _$props5.ariaId,\n        renderSearch = _$props5.renderSearch,\n        switcherIcon = _$props5.switcherIcon,\n        searchHalfCheckedKeys = _$props5.searchHalfCheckedKeys;\n    var _vcTreeSelect = this.vcTreeSelect,\n        onPopupKeyDown = _vcTreeSelect.onPopupKeyDown,\n        onTreeNodeSelect = _vcTreeSelect.onTreeNodeSelect,\n        onTreeNodeCheck = _vcTreeSelect.onTreeNodeCheck;\n\n\n    var loadData = this.getLoadData();\n\n    var treeProps = {};\n\n    if (treeCheckable) {\n      treeProps.checkedKeys = keyList;\n    } else {\n      treeProps.selectedKeys = keyList;\n    }\n    var $notFound = void 0;\n    var $treeNodes = void 0;\n    if (filteredTreeNodes) {\n      if (filteredTreeNodes.length) {\n        treeProps.checkStrictly = true;\n        $treeNodes = filteredTreeNodes;\n\n        // Fill halfCheckedKeys\n        if (treeCheckable && !treeCheckStrictly) {\n          treeProps.checkedKeys = {\n            checked: keyList,\n            halfChecked: searchHalfCheckedKeys\n          };\n        }\n      } else {\n        $notFound = this.renderNotFound();\n      }\n    } else if (!treeNodes || !treeNodes.length) {\n      $notFound = this.renderNotFound();\n    } else {\n      $treeNodes = treeNodes;\n    }\n\n    var $tree = void 0;\n    if ($notFound) {\n      $tree = $notFound;\n    } else {\n      var treeAllProps = {\n        props: _extends({\n          prefixCls: prefixCls + '-tree',\n          showIcon: treeIcon,\n          showLine: treeLine,\n          selectable: !treeCheckable,\n          checkable: treeCheckable,\n          checkStrictly: treeCheckStrictly,\n          multiple: multiple,\n          loadData: loadData,\n          loadedKeys: loadedKeys,\n          expandedKeys: expandedKeyList,\n          filterTreeNode: this.filterTreeNode,\n          switcherIcon: switcherIcon\n        }, treeProps, {\n          __propsSymbol__: Symbol(),\n          children: $treeNodes\n        }),\n        on: {\n          select: onTreeNodeSelect,\n          check: onTreeNodeCheck,\n          expand: this.onTreeExpand,\n          load: this.onLoad\n        },\n        directives: [{\n          name: 'ant-ref',\n          value: this.treeRef\n        }]\n      };\n      $tree = h(Tree, treeAllProps);\n    }\n\n    return h(\n      'div',\n      {\n        attrs: { role: 'listbox', id: ariaId, tabIndex: -1 },\n        on: {\n          'keydown': onPopupKeyDown\n        }\n      },\n      [renderSearch ? renderSearch() : null, $tree]\n    );\n  }\n};\n\nexport default BasePopup;"]},"metadata":{},"sourceType":"module"}