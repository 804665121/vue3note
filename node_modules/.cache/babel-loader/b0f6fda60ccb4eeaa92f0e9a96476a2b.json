{"ast":null,"code":"import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport classNames from 'classnames';\nimport getUid from './uid';\nimport warning from '../../_util/warning';\nvar IFRAME_STYLE = {\n  position: 'absolute',\n  top: 0,\n  opacity: 0,\n  filter: 'alpha(opacity=0)',\n  left: 0,\n  zIndex: 9999\n}; // diferent from AjaxUpload, can only upload on at one time, serial seriously\n\nvar IframeUploader = {\n  mixins: [BaseMixin],\n  props: {\n    componentTag: PropTypes.string,\n    // style: PropTypes.object,\n    disabled: PropTypes.bool,\n    prefixCls: PropTypes.string,\n    // className: PropTypes.string,\n    accept: PropTypes.string,\n    // onStart: PropTypes.func,\n    multiple: PropTypes.bool,\n    // children: PropTypes.any,\n    data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n    action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n    name: PropTypes.string\n  },\n  data: function data() {\n    this.file = {};\n    return {\n      uploading: false\n    };\n  },\n  methods: {\n    onLoad: function onLoad() {\n      if (!this.uploading) {\n        return;\n      }\n\n      var file = this.file;\n      var response = void 0;\n\n      try {\n        var doc = this.getIframeDocument();\n        var script = doc.getElementsByTagName('script')[0];\n\n        if (script && script.parentNode === doc.body) {\n          doc.body.removeChild(script);\n        }\n\n        response = doc.body.innerHTML;\n        this.$emit('success', response, file);\n      } catch (err) {\n        warning(false, 'cross domain error for Upload. Maybe server should return document.domain script. see Note from https://github.com/react-component/upload');\n        response = 'cross-domain';\n        this.$emit('error', err, null, file);\n      }\n\n      this.endUpload();\n    },\n    onChange: function onChange() {\n      var _this = this;\n\n      var target = this.getFormInputNode(); // ie8/9 don't support FileList Object\n      // http://stackoverflow.com/questions/12830058/ie8-input-type-file-get-files\n\n      var file = this.file = {\n        uid: getUid(),\n        name: target.value && target.value.substring(target.value.lastIndexOf('\\\\') + 1, target.value.length)\n      };\n      this.startUpload();\n      var props = this.$props;\n\n      if (!props.beforeUpload) {\n        return this.post(file);\n      }\n\n      var before = props.beforeUpload(file);\n\n      if (before && before.then) {\n        before.then(function () {\n          _this.post(file);\n        }, function () {\n          _this.endUpload();\n        });\n      } else if (before !== false) {\n        this.post(file);\n      } else {\n        this.endUpload();\n      }\n    },\n    getIframeNode: function getIframeNode() {\n      return this.$refs.iframeRef;\n    },\n    getIframeDocument: function getIframeDocument() {\n      return this.getIframeNode().contentDocument;\n    },\n    getFormNode: function getFormNode() {\n      return this.getIframeDocument().getElementById('form');\n    },\n    getFormInputNode: function getFormInputNode() {\n      return this.getIframeDocument().getElementById('input');\n    },\n    getFormDataNode: function getFormDataNode() {\n      return this.getIframeDocument().getElementById('data');\n    },\n    getFileForMultiple: function getFileForMultiple(file) {\n      return this.multiple ? [file] : file;\n    },\n    getIframeHTML: function getIframeHTML(domain) {\n      var domainScript = '';\n      var domainInput = '';\n\n      if (domain) {\n        var script = 'script';\n        domainScript = '<' + script + '>document.domain=\"' + domain + '\";</' + script + '>';\n        domainInput = '<input name=\"_documentDomain\" value=\"' + domain + '\" />';\n      }\n\n      return '\\n      <!DOCTYPE html>\\n      <html>\\n      <head>\\n      <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\\n      <style>\\n      body,html {padding:0;margin:0;border:0;overflow:hidden;}\\n      </style>\\n      ' + domainScript + '\\n      </head>\\n      <body>\\n      <form method=\"post\"\\n      encType=\"multipart/form-data\"\\n      action=\"\" id=\"form\"\\n      style=\"display:block;height:9999px;position:relative;overflow:hidden;\">\\n      <input id=\"input\" type=\"file\"\\n       name=\"' + this.name + '\"\\n       style=\"position:absolute;top:0;right:0;height:9999px;font-size:9999px;cursor:pointer;\"/>\\n      ' + domainInput + '\\n      <span id=\"data\"></span>\\n      </form>\\n      </body>\\n      </html>\\n      ';\n    },\n    initIframeSrc: function initIframeSrc() {\n      if (this.domain) {\n        this.getIframeNode().src = 'javascript:void((function(){\\n          var d = document;\\n          d.open();\\n          d.domain=\\'' + this.domain + '\\';\\n          d.write(\\'\\');\\n          d.close();\\n        })())';\n      }\n    },\n    initIframe: function initIframe() {\n      var iframeNode = this.getIframeNode();\n      var win = iframeNode.contentWindow;\n      var doc = void 0;\n      this.domain = this.domain || '';\n      this.initIframeSrc();\n\n      try {\n        doc = win.document;\n      } catch (e) {\n        this.domain = document.domain;\n        this.initIframeSrc();\n        win = iframeNode.contentWindow;\n        doc = win.document;\n      }\n\n      doc.open('text/html', 'replace');\n      doc.write(this.getIframeHTML(this.domain));\n      doc.close();\n      this.getFormInputNode().onchange = this.onChange;\n    },\n    endUpload: function endUpload() {\n      if (this.uploading) {\n        this.file = {}; // hack avoid batch\n\n        this.uploading = false;\n        this.setState({\n          uploading: false\n        });\n        this.initIframe();\n      }\n    },\n    startUpload: function startUpload() {\n      if (!this.uploading) {\n        this.uploading = true;\n        this.setState({\n          uploading: true\n        });\n      }\n    },\n    updateIframeWH: function updateIframeWH() {\n      var rootNode = this.$el;\n      var iframeNode = this.getIframeNode();\n      iframeNode.style.height = rootNode.offsetHeight + 'px';\n      iframeNode.style.width = rootNode.offsetWidth + 'px';\n    },\n    abort: function abort(file) {\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (uid === this.file.uid) {\n          this.endUpload();\n        }\n      } else {\n        this.endUpload();\n      }\n    },\n    post: function post(file) {\n      var _this2 = this;\n\n      var formNode = this.getFormNode();\n      var dataSpan = this.getFormDataNode();\n      var data = this.$props.data;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n\n      var inputs = document.createDocumentFragment();\n\n      for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n          var input = document.createElement('input');\n          input.setAttribute('name', key);\n          input.value = data[key];\n          inputs.appendChild(input);\n        }\n      }\n\n      dataSpan.appendChild(inputs);\n      new Promise(function (resolve) {\n        var action = _this2.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        formNode.setAttribute('action', action);\n        formNode.submit();\n        dataSpan.innerHTML = '';\n\n        _this2.$emit('start', file);\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.$nextTick(function () {\n      _this3.updateIframeWH();\n\n      _this3.initIframe();\n    });\n  },\n  updated: function updated() {\n    var _this4 = this;\n\n    this.$nextTick(function () {\n      _this4.updateIframeWH();\n    });\n  },\n  render: function render() {\n    var _classNames;\n\n    var h = arguments[0];\n    var _$props = this.$props,\n        Tag = _$props.componentTag,\n        disabled = _$props.disabled,\n        prefixCls = _$props.prefixCls;\n\n    var iframeStyle = _extends({}, IFRAME_STYLE, {\n      display: this.uploading || disabled ? 'none' : ''\n    });\n\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _classNames));\n    return h(Tag, {\n      attrs: {\n        className: cls\n      },\n      style: {\n        position: 'relative',\n        zIndex: 0\n      }\n    }, [h('iframe', {\n      ref: 'iframeRef',\n      on: {\n        'load': this.onLoad\n      },\n      style: iframeStyle\n    }), this.$slots['default']]);\n  }\n};\nexport default IframeUploader;","map":{"version":3,"sources":["/Users/liulu/刘璐/vue3/hello-vue3/node_modules/ant-design-vue/es/vc-upload/src/IframeUploader.js"],"names":["_defineProperty","_extends","PropTypes","BaseMixin","classNames","getUid","warning","IFRAME_STYLE","position","top","opacity","filter","left","zIndex","IframeUploader","mixins","props","componentTag","string","disabled","bool","prefixCls","accept","multiple","data","oneOfType","object","func","action","name","file","uploading","methods","onLoad","response","doc","getIframeDocument","script","getElementsByTagName","parentNode","body","removeChild","innerHTML","$emit","err","endUpload","onChange","_this","target","getFormInputNode","uid","value","substring","lastIndexOf","length","startUpload","$props","beforeUpload","post","before","then","getIframeNode","$refs","iframeRef","contentDocument","getFormNode","getElementById","getFormDataNode","getFileForMultiple","getIframeHTML","domain","domainScript","domainInput","initIframeSrc","src","initIframe","iframeNode","win","contentWindow","document","e","open","write","close","onchange","setState","updateIframeWH","rootNode","$el","style","height","offsetHeight","width","offsetWidth","abort","_this2","formNode","dataSpan","inputs","createDocumentFragment","key","hasOwnProperty","input","createElement","setAttribute","appendChild","Promise","resolve","submit","mounted","_this3","$nextTick","updated","_this4","render","_classNames","h","arguments","_$props","Tag","iframeStyle","display","cls","attrs","className","ref","on","$slots"],"mappings":"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","sourcesContent":["import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport classNames from 'classnames';\nimport getUid from './uid';\nimport warning from '../../_util/warning';\n\nvar IFRAME_STYLE = {\n  position: 'absolute',\n  top: 0,\n  opacity: 0,\n  filter: 'alpha(opacity=0)',\n  left: 0,\n  zIndex: 9999\n};\n\n// diferent from AjaxUpload, can only upload on at one time, serial seriously\nvar IframeUploader = {\n  mixins: [BaseMixin],\n  props: {\n    componentTag: PropTypes.string,\n    // style: PropTypes.object,\n    disabled: PropTypes.bool,\n    prefixCls: PropTypes.string,\n    // className: PropTypes.string,\n    accept: PropTypes.string,\n    // onStart: PropTypes.func,\n    multiple: PropTypes.bool,\n    // children: PropTypes.any,\n    data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n    action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n    name: PropTypes.string\n  },\n  data: function data() {\n    this.file = {};\n    return {\n      uploading: false\n    };\n  },\n\n  methods: {\n    onLoad: function onLoad() {\n      if (!this.uploading) {\n        return;\n      }\n      var file = this.file;\n\n      var response = void 0;\n      try {\n        var doc = this.getIframeDocument();\n        var script = doc.getElementsByTagName('script')[0];\n        if (script && script.parentNode === doc.body) {\n          doc.body.removeChild(script);\n        }\n        response = doc.body.innerHTML;\n        this.$emit('success', response, file);\n      } catch (err) {\n        warning(false, 'cross domain error for Upload. Maybe server should return document.domain script. see Note from https://github.com/react-component/upload');\n        response = 'cross-domain';\n        this.$emit('error', err, null, file);\n      }\n      this.endUpload();\n    },\n    onChange: function onChange() {\n      var _this = this;\n\n      var target = this.getFormInputNode();\n      // ie8/9 don't support FileList Object\n      // http://stackoverflow.com/questions/12830058/ie8-input-type-file-get-files\n      var file = this.file = {\n        uid: getUid(),\n        name: target.value && target.value.substring(target.value.lastIndexOf('\\\\') + 1, target.value.length)\n      };\n      this.startUpload();\n      var props = this.$props;\n\n      if (!props.beforeUpload) {\n        return this.post(file);\n      }\n      var before = props.beforeUpload(file);\n      if (before && before.then) {\n        before.then(function () {\n          _this.post(file);\n        }, function () {\n          _this.endUpload();\n        });\n      } else if (before !== false) {\n        this.post(file);\n      } else {\n        this.endUpload();\n      }\n    },\n    getIframeNode: function getIframeNode() {\n      return this.$refs.iframeRef;\n    },\n    getIframeDocument: function getIframeDocument() {\n      return this.getIframeNode().contentDocument;\n    },\n    getFormNode: function getFormNode() {\n      return this.getIframeDocument().getElementById('form');\n    },\n    getFormInputNode: function getFormInputNode() {\n      return this.getIframeDocument().getElementById('input');\n    },\n    getFormDataNode: function getFormDataNode() {\n      return this.getIframeDocument().getElementById('data');\n    },\n    getFileForMultiple: function getFileForMultiple(file) {\n      return this.multiple ? [file] : file;\n    },\n    getIframeHTML: function getIframeHTML(domain) {\n      var domainScript = '';\n      var domainInput = '';\n      if (domain) {\n        var script = 'script';\n        domainScript = '<' + script + '>document.domain=\"' + domain + '\";</' + script + '>';\n        domainInput = '<input name=\"_documentDomain\" value=\"' + domain + '\" />';\n      }\n      return '\\n      <!DOCTYPE html>\\n      <html>\\n      <head>\\n      <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\\n      <style>\\n      body,html {padding:0;margin:0;border:0;overflow:hidden;}\\n      </style>\\n      ' + domainScript + '\\n      </head>\\n      <body>\\n      <form method=\"post\"\\n      encType=\"multipart/form-data\"\\n      action=\"\" id=\"form\"\\n      style=\"display:block;height:9999px;position:relative;overflow:hidden;\">\\n      <input id=\"input\" type=\"file\"\\n       name=\"' + this.name + '\"\\n       style=\"position:absolute;top:0;right:0;height:9999px;font-size:9999px;cursor:pointer;\"/>\\n      ' + domainInput + '\\n      <span id=\"data\"></span>\\n      </form>\\n      </body>\\n      </html>\\n      ';\n    },\n    initIframeSrc: function initIframeSrc() {\n      if (this.domain) {\n        this.getIframeNode().src = 'javascript:void((function(){\\n          var d = document;\\n          d.open();\\n          d.domain=\\'' + this.domain + '\\';\\n          d.write(\\'\\');\\n          d.close();\\n        })())';\n      }\n    },\n    initIframe: function initIframe() {\n      var iframeNode = this.getIframeNode();\n      var win = iframeNode.contentWindow;\n      var doc = void 0;\n      this.domain = this.domain || '';\n      this.initIframeSrc();\n      try {\n        doc = win.document;\n      } catch (e) {\n        this.domain = document.domain;\n        this.initIframeSrc();\n        win = iframeNode.contentWindow;\n        doc = win.document;\n      }\n      doc.open('text/html', 'replace');\n      doc.write(this.getIframeHTML(this.domain));\n      doc.close();\n      this.getFormInputNode().onchange = this.onChange;\n    },\n    endUpload: function endUpload() {\n      if (this.uploading) {\n        this.file = {};\n        // hack avoid batch\n        this.uploading = false;\n        this.setState({\n          uploading: false\n        });\n        this.initIframe();\n      }\n    },\n    startUpload: function startUpload() {\n      if (!this.uploading) {\n        this.uploading = true;\n        this.setState({\n          uploading: true\n        });\n      }\n    },\n    updateIframeWH: function updateIframeWH() {\n      var rootNode = this.$el;\n      var iframeNode = this.getIframeNode();\n      iframeNode.style.height = rootNode.offsetHeight + 'px';\n      iframeNode.style.width = rootNode.offsetWidth + 'px';\n    },\n    abort: function abort(file) {\n      if (file) {\n        var uid = file;\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n        if (uid === this.file.uid) {\n          this.endUpload();\n        }\n      } else {\n        this.endUpload();\n      }\n    },\n    post: function post(file) {\n      var _this2 = this;\n\n      var formNode = this.getFormNode();\n      var dataSpan = this.getFormDataNode();\n      var data = this.$props.data;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n      var inputs = document.createDocumentFragment();\n      for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n          var input = document.createElement('input');\n          input.setAttribute('name', key);\n          input.value = data[key];\n          inputs.appendChild(input);\n        }\n      }\n      dataSpan.appendChild(inputs);\n      new Promise(function (resolve) {\n        var action = _this2.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n        resolve(action);\n      }).then(function (action) {\n        formNode.setAttribute('action', action);\n        formNode.submit();\n        dataSpan.innerHTML = '';\n        _this2.$emit('start', file);\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.$nextTick(function () {\n      _this3.updateIframeWH();\n      _this3.initIframe();\n    });\n  },\n  updated: function updated() {\n    var _this4 = this;\n\n    this.$nextTick(function () {\n      _this4.updateIframeWH();\n    });\n  },\n  render: function render() {\n    var _classNames;\n\n    var h = arguments[0];\n    var _$props = this.$props,\n        Tag = _$props.componentTag,\n        disabled = _$props.disabled,\n        prefixCls = _$props.prefixCls;\n\n    var iframeStyle = _extends({}, IFRAME_STYLE, {\n      display: this.uploading || disabled ? 'none' : ''\n    });\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _classNames));\n\n    return h(\n      Tag,\n      {\n        attrs: { className: cls },\n        style: { position: 'relative', zIndex: 0 } },\n      [h('iframe', { ref: 'iframeRef', on: {\n          'load': this.onLoad\n        },\n        style: iframeStyle }), this.$slots['default']]\n    );\n  }\n};\n\nexport default IframeUploader;"]},"metadata":{},"sourceType":"module"}