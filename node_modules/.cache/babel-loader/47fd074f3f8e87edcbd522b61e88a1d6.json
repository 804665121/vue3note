{"ast":null,"code":"import _mergeJSXProps from 'babel-helper-vue-jsx-merge-props';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport classNames from 'classnames';\nimport uniqBy from 'lodash/uniqBy';\nimport findIndex from 'lodash/findIndex';\nimport pick from 'lodash/pick';\nimport VcUpload from '../vc-upload';\nimport BaseMixin from '../_util/BaseMixin';\nimport { getOptionProps, initDefaultProps, hasProp, getListeners } from '../_util/props-util';\nimport LocaleReceiver from '../locale-provider/LocaleReceiver';\nimport defaultLocale from '../locale-provider/default';\nimport { ConfigConsumerProps } from '../config-provider/configConsumerProps';\nimport Dragger from './Dragger';\nimport UploadList from './UploadList';\nimport { UploadProps } from './interface';\nimport { T, fileToObject, genPercentAdd, getFileItem, removeFileItem } from './utils';\nexport { UploadProps };\nexport default {\n  name: 'AUpload',\n  mixins: [BaseMixin],\n  inheritAttrs: false,\n  Dragger: Dragger,\n  props: initDefaultProps(UploadProps, {\n    type: 'select',\n    multiple: false,\n    action: '',\n    data: {},\n    accept: '',\n    beforeUpload: T,\n    showUploadList: true,\n    listType: 'text',\n    // or pictrue\n    disabled: false,\n    supportServerRender: true\n  }),\n  inject: {\n    configProvider: {\n      'default': function _default() {\n        return ConfigConsumerProps;\n      }\n    }\n  },\n  // recentUploadStatus: boolean | PromiseLike<any>;\n  data: function data() {\n    this.progressTimer = null;\n    return {\n      sFileList: this.fileList || this.defaultFileList || [],\n      dragState: 'drop'\n    };\n  },\n  watch: {\n    fileList: function fileList(val) {\n      this.sFileList = val || [];\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.clearProgressTimer();\n  },\n  methods: {\n    onStart: function onStart(file) {\n      var targetItem = fileToObject(file);\n      targetItem.status = 'uploading';\n      var nextFileList = this.sFileList.concat();\n      var fileIndex = findIndex(nextFileList, function (_ref) {\n        var uid = _ref.uid;\n        return uid === targetItem.uid;\n      });\n\n      if (fileIndex === -1) {\n        nextFileList.push(targetItem);\n      } else {\n        nextFileList[fileIndex] = targetItem;\n      }\n\n      this.onChange({\n        file: targetItem,\n        fileList: nextFileList\n      }); // fix ie progress\n\n      if (!window.File || process.env.TEST_IE) {\n        this.autoUpdateProgress(0, targetItem);\n      }\n    },\n    onSuccess: function onSuccess(response, file, xhr) {\n      this.clearProgressTimer();\n\n      try {\n        if (typeof response === 'string') {\n          response = JSON.parse(response);\n        }\n      } catch (e) {\n        /* do nothing */\n      }\n\n      var fileList = this.sFileList;\n      var targetItem = getFileItem(file, fileList); // removed\n\n      if (!targetItem) {\n        return;\n      }\n\n      targetItem.status = 'done';\n      targetItem.response = response;\n      targetItem.xhr = xhr;\n      this.onChange({\n        file: _extends({}, targetItem),\n        fileList: fileList\n      });\n    },\n    onProgress: function onProgress(e, file) {\n      var fileList = this.sFileList;\n      var targetItem = getFileItem(file, fileList); // removed\n\n      if (!targetItem) {\n        return;\n      }\n\n      targetItem.percent = e.percent;\n      this.onChange({\n        event: e,\n        file: _extends({}, targetItem),\n        fileList: this.sFileList\n      });\n    },\n    onError: function onError(error, response, file) {\n      this.clearProgressTimer();\n      var fileList = this.sFileList;\n      var targetItem = getFileItem(file, fileList); // removed\n\n      if (!targetItem) {\n        return;\n      }\n\n      targetItem.error = error;\n      targetItem.response = response;\n      targetItem.status = 'error';\n      this.onChange({\n        file: _extends({}, targetItem),\n        fileList: fileList\n      });\n    },\n    onReject: function onReject(fileList) {\n      this.$emit('reject', fileList);\n    },\n    handleRemove: function handleRemove(file) {\n      var _this = this;\n\n      var onRemove = this.remove;\n      var fileList = this.$data.sFileList;\n      Promise.resolve(typeof onRemove === 'function' ? onRemove(file) : onRemove).then(function (ret) {\n        // Prevent removing file\n        if (ret === false) {\n          return;\n        }\n\n        var removedFileList = removeFileItem(file, fileList);\n\n        if (removedFileList) {\n          file.status = 'removed'; // eslint-disable-line\n\n          if (_this.upload) {\n            _this.upload.abort(file);\n          }\n\n          _this.onChange({\n            file: file,\n            fileList: removedFileList\n          });\n        }\n      });\n    },\n    handleManualRemove: function handleManualRemove(file) {\n      if (this.$refs.uploadRef) {\n        this.$refs.uploadRef.abort(file);\n      }\n\n      this.handleRemove(file);\n    },\n    onChange: function onChange(info) {\n      if (!hasProp(this, 'fileList')) {\n        this.setState({\n          sFileList: info.fileList\n        });\n      }\n\n      this.$emit('change', info);\n    },\n    onFileDrop: function onFileDrop(e) {\n      this.setState({\n        dragState: e.type\n      });\n    },\n    reBeforeUpload: function reBeforeUpload(file, fileList) {\n      var beforeUpload = this.$props.beforeUpload;\n      var stateFileList = this.$data.sFileList;\n\n      if (!beforeUpload) {\n        return true;\n      }\n\n      var result = beforeUpload(file, fileList);\n\n      if (result === false) {\n        this.onChange({\n          file: file,\n          fileList: uniqBy(stateFileList.concat(fileList.map(fileToObject)), function (item) {\n            return item.uid;\n          })\n        });\n        return false;\n      }\n\n      if (result && result.then) {\n        return result;\n      }\n\n      return true;\n    },\n    clearProgressTimer: function clearProgressTimer() {\n      clearInterval(this.progressTimer);\n    },\n    autoUpdateProgress: function autoUpdateProgress(_, file) {\n      var _this2 = this;\n\n      var getPercent = genPercentAdd();\n      var curPercent = 0;\n      this.clearProgressTimer();\n      this.progressTimer = setInterval(function () {\n        curPercent = getPercent(curPercent);\n\n        _this2.onProgress({\n          percent: curPercent * 100\n        }, file);\n      }, 200);\n    },\n    renderUploadList: function renderUploadList(locale) {\n      var h = this.$createElement;\n\n      var _getOptionProps = getOptionProps(this),\n          _getOptionProps$showU = _getOptionProps.showUploadList,\n          showUploadList = _getOptionProps$showU === undefined ? {} : _getOptionProps$showU,\n          listType = _getOptionProps.listType,\n          previewFile = _getOptionProps.previewFile,\n          disabled = _getOptionProps.disabled,\n          propLocale = _getOptionProps.locale;\n\n      var showRemoveIcon = showUploadList.showRemoveIcon,\n          showPreviewIcon = showUploadList.showPreviewIcon,\n          showDownloadIcon = showUploadList.showDownloadIcon;\n      var fileList = this.$data.sFileList;\n      var uploadListProps = {\n        props: {\n          listType: listType,\n          items: fileList,\n          previewFile: previewFile,\n          showRemoveIcon: !disabled && showRemoveIcon,\n          showPreviewIcon: showPreviewIcon,\n          showDownloadIcon: showDownloadIcon,\n          locale: _extends({}, locale, propLocale)\n        },\n        on: _extends({\n          remove: this.handleManualRemove\n        }, pick(getListeners(this), ['download', 'preview']))\n      };\n      return h(UploadList, uploadListProps);\n    }\n  },\n  render: function render() {\n    var _classNames2;\n\n    var h = arguments[0];\n\n    var _getOptionProps2 = getOptionProps(this),\n        customizePrefixCls = _getOptionProps2.prefixCls,\n        showUploadList = _getOptionProps2.showUploadList,\n        listType = _getOptionProps2.listType,\n        type = _getOptionProps2.type,\n        disabled = _getOptionProps2.disabled;\n\n    var _$data = this.$data,\n        fileList = _$data.sFileList,\n        dragState = _$data.dragState;\n    var getPrefixCls = this.configProvider.getPrefixCls;\n    var prefixCls = getPrefixCls('upload', customizePrefixCls);\n    var vcUploadProps = {\n      props: _extends({}, this.$props, {\n        prefixCls: prefixCls,\n        beforeUpload: this.reBeforeUpload\n      }),\n      on: {\n        start: this.onStart,\n        error: this.onError,\n        progress: this.onProgress,\n        success: this.onSuccess,\n        reject: this.onReject\n      },\n      ref: 'uploadRef',\n      attrs: _extends({}, this.$attrs)\n    };\n    var children = this.$slots['default']; // Remove id to avoid open by label when trigger is hidden\n    // https://github.com/ant-design/ant-design/issues/14298\n\n    if (!children || disabled) {\n      delete vcUploadProps.props.id;\n      delete vcUploadProps.attrs.id;\n    }\n\n    var uploadList = showUploadList ? h(LocaleReceiver, {\n      attrs: {\n        componentName: 'Upload',\n        defaultLocale: defaultLocale.Upload\n      },\n      scopedSlots: {\n        'default': this.renderUploadList\n      }\n    }) : null;\n\n    if (type === 'drag') {\n      var _classNames;\n\n      var dragCls = classNames(prefixCls, (_classNames = {}, _defineProperty(_classNames, prefixCls + '-drag', true), _defineProperty(_classNames, prefixCls + '-drag-uploading', fileList.some(function (file) {\n        return file.status === 'uploading';\n      })), _defineProperty(_classNames, prefixCls + '-drag-hover', dragState === 'dragover'), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _classNames));\n      return h('span', [h('div', {\n        'class': dragCls,\n        on: {\n          'drop': this.onFileDrop,\n          'dragover': this.onFileDrop,\n          'dragleave': this.onFileDrop\n        }\n      }, [h(VcUpload, _mergeJSXProps([vcUploadProps, {\n        'class': prefixCls + '-btn'\n      }]), [h('div', {\n        'class': prefixCls + '-drag-container'\n      }, [children])])]), uploadList]);\n    }\n\n    var uploadButtonCls = classNames(prefixCls, (_classNames2 = {}, _defineProperty(_classNames2, prefixCls + '-select', true), _defineProperty(_classNames2, prefixCls + '-select-' + listType, true), _defineProperty(_classNames2, prefixCls + '-disabled', disabled), _classNames2));\n    var uploadButton = h('div', {\n      'class': uploadButtonCls,\n      style: children ? undefined : {\n        display: 'none'\n      }\n    }, [h(VcUpload, vcUploadProps, [children])]);\n\n    if (listType === 'picture-card') {\n      return h('span', {\n        'class': prefixCls + '-picture-card-wrapper'\n      }, [uploadList, uploadButton]);\n    }\n\n    return h('span', [uploadButton, uploadList]);\n  }\n};","map":{"version":3,"sources":["/Users/liulu/刘璐/vue3/hello-vue3/node_modules/ant-design-vue/es/upload/Upload.js"],"names":["_mergeJSXProps","_defineProperty","_extends","classNames","uniqBy","findIndex","pick","VcUpload","BaseMixin","getOptionProps","initDefaultProps","hasProp","getListeners","LocaleReceiver","defaultLocale","ConfigConsumerProps","Dragger","UploadList","UploadProps","T","fileToObject","genPercentAdd","getFileItem","removeFileItem","name","mixins","inheritAttrs","props","type","multiple","action","data","accept","beforeUpload","showUploadList","listType","disabled","supportServerRender","inject","configProvider","_default","progressTimer","sFileList","fileList","defaultFileList","dragState","watch","val","beforeDestroy","clearProgressTimer","methods","onStart","file","targetItem","status","nextFileList","concat","fileIndex","_ref","uid","push","onChange","window","File","process","env","TEST_IE","autoUpdateProgress","onSuccess","response","xhr","JSON","parse","e","onProgress","percent","event","onError","error","onReject","$emit","handleRemove","_this","onRemove","remove","$data","Promise","resolve","then","ret","removedFileList","upload","abort","handleManualRemove","$refs","uploadRef","info","setState","onFileDrop","reBeforeUpload","$props","stateFileList","result","map","item","clearInterval","_","_this2","getPercent","curPercent","setInterval","renderUploadList","locale","h","$createElement","_getOptionProps","_getOptionProps$showU","undefined","previewFile","propLocale","showRemoveIcon","showPreviewIcon","showDownloadIcon","uploadListProps","items","on","render","_classNames2","arguments","_getOptionProps2","customizePrefixCls","prefixCls","_$data","getPrefixCls","vcUploadProps","start","progress","success","reject","ref","attrs","$attrs","children","$slots","id","uploadList","componentName","Upload","scopedSlots","_classNames","dragCls","some","uploadButtonCls","uploadButton","style","display"],"mappings":"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","sourcesContent":["import _mergeJSXProps from 'babel-helper-vue-jsx-merge-props';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport classNames from 'classnames';\nimport uniqBy from 'lodash/uniqBy';\nimport findIndex from 'lodash/findIndex';\nimport pick from 'lodash/pick';\nimport VcUpload from '../vc-upload';\nimport BaseMixin from '../_util/BaseMixin';\nimport { getOptionProps, initDefaultProps, hasProp, getListeners } from '../_util/props-util';\nimport LocaleReceiver from '../locale-provider/LocaleReceiver';\nimport defaultLocale from '../locale-provider/default';\nimport { ConfigConsumerProps } from '../config-provider/configConsumerProps';\nimport Dragger from './Dragger';\nimport UploadList from './UploadList';\nimport { UploadProps } from './interface';\nimport { T, fileToObject, genPercentAdd, getFileItem, removeFileItem } from './utils';\n\nexport { UploadProps };\n\nexport default {\n  name: 'AUpload',\n  mixins: [BaseMixin],\n  inheritAttrs: false,\n  Dragger: Dragger,\n  props: initDefaultProps(UploadProps, {\n    type: 'select',\n    multiple: false,\n    action: '',\n    data: {},\n    accept: '',\n    beforeUpload: T,\n    showUploadList: true,\n    listType: 'text', // or pictrue\n    disabled: false,\n    supportServerRender: true\n  }),\n  inject: {\n    configProvider: { 'default': function _default() {\n        return ConfigConsumerProps;\n      } }\n  },\n  // recentUploadStatus: boolean | PromiseLike<any>;\n  data: function data() {\n    this.progressTimer = null;\n    return {\n      sFileList: this.fileList || this.defaultFileList || [],\n      dragState: 'drop'\n    };\n  },\n\n  watch: {\n    fileList: function fileList(val) {\n      this.sFileList = val || [];\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.clearProgressTimer();\n  },\n\n  methods: {\n    onStart: function onStart(file) {\n      var targetItem = fileToObject(file);\n      targetItem.status = 'uploading';\n      var nextFileList = this.sFileList.concat();\n      var fileIndex = findIndex(nextFileList, function (_ref) {\n        var uid = _ref.uid;\n        return uid === targetItem.uid;\n      });\n      if (fileIndex === -1) {\n        nextFileList.push(targetItem);\n      } else {\n        nextFileList[fileIndex] = targetItem;\n      }\n      this.onChange({\n        file: targetItem,\n        fileList: nextFileList\n      });\n      // fix ie progress\n      if (!window.File || process.env.TEST_IE) {\n        this.autoUpdateProgress(0, targetItem);\n      }\n    },\n    onSuccess: function onSuccess(response, file, xhr) {\n      this.clearProgressTimer();\n      try {\n        if (typeof response === 'string') {\n          response = JSON.parse(response);\n        }\n      } catch (e) {\n        /* do nothing */\n      }\n      var fileList = this.sFileList;\n      var targetItem = getFileItem(file, fileList);\n      // removed\n      if (!targetItem) {\n        return;\n      }\n      targetItem.status = 'done';\n      targetItem.response = response;\n      targetItem.xhr = xhr;\n      this.onChange({\n        file: _extends({}, targetItem),\n        fileList: fileList\n      });\n    },\n    onProgress: function onProgress(e, file) {\n      var fileList = this.sFileList;\n      var targetItem = getFileItem(file, fileList);\n      // removed\n      if (!targetItem) {\n        return;\n      }\n      targetItem.percent = e.percent;\n      this.onChange({\n        event: e,\n        file: _extends({}, targetItem),\n        fileList: this.sFileList\n      });\n    },\n    onError: function onError(error, response, file) {\n      this.clearProgressTimer();\n      var fileList = this.sFileList;\n      var targetItem = getFileItem(file, fileList);\n      // removed\n      if (!targetItem) {\n        return;\n      }\n      targetItem.error = error;\n      targetItem.response = response;\n      targetItem.status = 'error';\n      this.onChange({\n        file: _extends({}, targetItem),\n        fileList: fileList\n      });\n    },\n    onReject: function onReject(fileList) {\n      this.$emit('reject', fileList);\n    },\n    handleRemove: function handleRemove(file) {\n      var _this = this;\n\n      var onRemove = this.remove;\n      var fileList = this.$data.sFileList;\n\n\n      Promise.resolve(typeof onRemove === 'function' ? onRemove(file) : onRemove).then(function (ret) {\n        // Prevent removing file\n        if (ret === false) {\n          return;\n        }\n\n        var removedFileList = removeFileItem(file, fileList);\n\n        if (removedFileList) {\n          file.status = 'removed'; // eslint-disable-line\n\n          if (_this.upload) {\n            _this.upload.abort(file);\n          }\n\n          _this.onChange({\n            file: file,\n            fileList: removedFileList\n          });\n        }\n      });\n    },\n    handleManualRemove: function handleManualRemove(file) {\n      if (this.$refs.uploadRef) {\n        this.$refs.uploadRef.abort(file);\n      }\n      this.handleRemove(file);\n    },\n    onChange: function onChange(info) {\n      if (!hasProp(this, 'fileList')) {\n        this.setState({ sFileList: info.fileList });\n      }\n      this.$emit('change', info);\n    },\n    onFileDrop: function onFileDrop(e) {\n      this.setState({\n        dragState: e.type\n      });\n    },\n    reBeforeUpload: function reBeforeUpload(file, fileList) {\n      var beforeUpload = this.$props.beforeUpload;\n      var stateFileList = this.$data.sFileList;\n\n      if (!beforeUpload) {\n        return true;\n      }\n      var result = beforeUpload(file, fileList);\n      if (result === false) {\n        this.onChange({\n          file: file,\n          fileList: uniqBy(stateFileList.concat(fileList.map(fileToObject)), function (item) {\n            return item.uid;\n          })\n        });\n        return false;\n      }\n      if (result && result.then) {\n        return result;\n      }\n      return true;\n    },\n    clearProgressTimer: function clearProgressTimer() {\n      clearInterval(this.progressTimer);\n    },\n    autoUpdateProgress: function autoUpdateProgress(_, file) {\n      var _this2 = this;\n\n      var getPercent = genPercentAdd();\n      var curPercent = 0;\n      this.clearProgressTimer();\n      this.progressTimer = setInterval(function () {\n        curPercent = getPercent(curPercent);\n        _this2.onProgress({\n          percent: curPercent * 100\n        }, file);\n      }, 200);\n    },\n    renderUploadList: function renderUploadList(locale) {\n      var h = this.$createElement;\n\n      var _getOptionProps = getOptionProps(this),\n          _getOptionProps$showU = _getOptionProps.showUploadList,\n          showUploadList = _getOptionProps$showU === undefined ? {} : _getOptionProps$showU,\n          listType = _getOptionProps.listType,\n          previewFile = _getOptionProps.previewFile,\n          disabled = _getOptionProps.disabled,\n          propLocale = _getOptionProps.locale;\n\n      var showRemoveIcon = showUploadList.showRemoveIcon,\n          showPreviewIcon = showUploadList.showPreviewIcon,\n          showDownloadIcon = showUploadList.showDownloadIcon;\n      var fileList = this.$data.sFileList;\n\n      var uploadListProps = {\n        props: {\n          listType: listType,\n          items: fileList,\n          previewFile: previewFile,\n          showRemoveIcon: !disabled && showRemoveIcon,\n          showPreviewIcon: showPreviewIcon,\n          showDownloadIcon: showDownloadIcon,\n          locale: _extends({}, locale, propLocale)\n        },\n        on: _extends({\n          remove: this.handleManualRemove\n        }, pick(getListeners(this), ['download', 'preview']))\n      };\n      return h(UploadList, uploadListProps);\n    }\n  },\n  render: function render() {\n    var _classNames2;\n\n    var h = arguments[0];\n\n    var _getOptionProps2 = getOptionProps(this),\n        customizePrefixCls = _getOptionProps2.prefixCls,\n        showUploadList = _getOptionProps2.showUploadList,\n        listType = _getOptionProps2.listType,\n        type = _getOptionProps2.type,\n        disabled = _getOptionProps2.disabled;\n\n    var _$data = this.$data,\n        fileList = _$data.sFileList,\n        dragState = _$data.dragState;\n\n    var getPrefixCls = this.configProvider.getPrefixCls;\n    var prefixCls = getPrefixCls('upload', customizePrefixCls);\n\n    var vcUploadProps = {\n      props: _extends({}, this.$props, {\n        prefixCls: prefixCls,\n        beforeUpload: this.reBeforeUpload\n      }),\n      on: {\n        start: this.onStart,\n        error: this.onError,\n        progress: this.onProgress,\n        success: this.onSuccess,\n        reject: this.onReject\n      },\n      ref: 'uploadRef',\n      attrs: _extends({}, this.$attrs)\n    };\n    var children = this.$slots['default'];\n    // Remove id to avoid open by label when trigger is hidden\n    // https://github.com/ant-design/ant-design/issues/14298\n    if (!children || disabled) {\n      delete vcUploadProps.props.id;\n      delete vcUploadProps.attrs.id;\n    }\n    var uploadList = showUploadList ? h(LocaleReceiver, {\n      attrs: {\n        componentName: 'Upload',\n        defaultLocale: defaultLocale.Upload\n      },\n      scopedSlots: { 'default': this.renderUploadList }\n    }) : null;\n\n    if (type === 'drag') {\n      var _classNames;\n\n      var dragCls = classNames(prefixCls, (_classNames = {}, _defineProperty(_classNames, prefixCls + '-drag', true), _defineProperty(_classNames, prefixCls + '-drag-uploading', fileList.some(function (file) {\n        return file.status === 'uploading';\n      })), _defineProperty(_classNames, prefixCls + '-drag-hover', dragState === 'dragover'), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _classNames));\n      return h('span', [h(\n        'div',\n        {\n          'class': dragCls,\n          on: {\n            'drop': this.onFileDrop,\n            'dragover': this.onFileDrop,\n            'dragleave': this.onFileDrop\n          }\n        },\n        [h(\n          VcUpload,\n          _mergeJSXProps([vcUploadProps, { 'class': prefixCls + '-btn' }]),\n          [h(\n            'div',\n            { 'class': prefixCls + '-drag-container' },\n            [children]\n          )]\n        )]\n      ), uploadList]);\n    }\n\n    var uploadButtonCls = classNames(prefixCls, (_classNames2 = {}, _defineProperty(_classNames2, prefixCls + '-select', true), _defineProperty(_classNames2, prefixCls + '-select-' + listType, true), _defineProperty(_classNames2, prefixCls + '-disabled', disabled), _classNames2));\n\n    var uploadButton = h(\n      'div',\n      { 'class': uploadButtonCls, style: children ? undefined : { display: 'none' } },\n      [h(\n        VcUpload,\n        vcUploadProps,\n        [children]\n      )]\n    );\n\n    if (listType === 'picture-card') {\n      return h(\n        'span',\n        { 'class': prefixCls + '-picture-card-wrapper' },\n        [uploadList, uploadButton]\n      );\n    }\n    return h('span', [uploadButton, uploadList]);\n  }\n};"]},"metadata":{},"sourceType":"module"}