{"ast":null,"code":"import _toConsumableArray from 'babel-runtime/helpers/toConsumableArray';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport PropTypes from '../_util/vue-types';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport SubMenu from './SubMenu';\nimport BaseMixin from '../_util/BaseMixin';\nimport { getWidth, setStyle, menuAllProps } from './util';\nimport { cloneElement } from '../_util/vnode';\nimport { getClass, getPropsData, getEvents, getListeners } from '../_util/props-util';\nvar canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);\nvar MENUITEM_OVERFLOWED_CLASSNAME = 'menuitem-overflowed';\nvar FLOAT_PRECISION_ADJUST = 0.5; // Fix ssr\n\nif (canUseDOM) {\n  require('mutationobserver-shim');\n}\n\nvar DOMWrap = {\n  name: 'DOMWrap',\n  mixins: [BaseMixin],\n  data: function data() {\n    this.resizeObserver = null;\n    this.mutationObserver = null; // original scroll size of the list\n\n    this.originalTotalWidth = 0; // copy of overflowed items\n\n    this.overflowedItems = []; // cache item of the original items (so we can track the size and order)\n\n    this.menuItemSizes = [];\n    return {\n      lastVisibleIndex: undefined\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$nextTick(function () {\n      _this.setChildrenWidthAndResize();\n\n      if (_this.level === 1 && _this.mode === 'horizontal') {\n        var menuUl = _this.$el;\n\n        if (!menuUl) {\n          return;\n        }\n\n        _this.resizeObserver = new ResizeObserver(function (entries) {\n          entries.forEach(_this.setChildrenWidthAndResize);\n        });\n        [].slice.call(menuUl.children).concat(menuUl).forEach(function (el) {\n          _this.resizeObserver.observe(el);\n        });\n\n        if (typeof MutationObserver !== 'undefined') {\n          _this.mutationObserver = new MutationObserver(function () {\n            _this.resizeObserver.disconnect();\n\n            [].slice.call(menuUl.children).concat(menuUl).forEach(function (el) {\n              _this.resizeObserver.observe(el);\n            });\n\n            _this.setChildrenWidthAndResize();\n          });\n\n          _this.mutationObserver.observe(menuUl, {\n            attributes: false,\n            childList: true,\n            subTree: false\n          });\n        }\n      }\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n\n    if (this.mutationObserver) {\n      this.mutationObserver.disconnect();\n    }\n  },\n  methods: {\n    // get all valid menuItem nodes\n    getMenuItemNodes: function getMenuItemNodes() {\n      var prefixCls = this.$props.prefixCls;\n      var ul = this.$el;\n\n      if (!ul) {\n        return [];\n      } // filter out all overflowed indicator placeholder\n\n\n      return [].slice.call(ul.children).filter(function (node) {\n        return node.className.split(' ').indexOf(prefixCls + '-overflowed-submenu') < 0;\n      });\n    },\n    getOverflowedSubMenuItem: function getOverflowedSubMenuItem(keyPrefix, overflowedItems, renderPlaceholder) {\n      var h = this.$createElement;\n      var _$props = this.$props,\n          overflowedIndicator = _$props.overflowedIndicator,\n          level = _$props.level,\n          mode = _$props.mode,\n          prefixCls = _$props.prefixCls,\n          theme = _$props.theme;\n\n      if (level !== 1 || mode !== 'horizontal') {\n        return null;\n      } // put all the overflowed item inside a submenu\n      // with a title of overflow indicator ('...')\n\n\n      var copy = this.$slots['default'][0];\n\n      var _getPropsData = getPropsData(copy),\n          title = _getPropsData.title,\n          rest = _objectWithoutProperties(_getPropsData, ['title']); // eslint-disable-line no-unused-vars\n\n\n      var events = getEvents(copy);\n      var style = {};\n      var key = keyPrefix + '-overflowed-indicator';\n      var eventKey = keyPrefix + '-overflowed-indicator';\n\n      if (overflowedItems.length === 0 && renderPlaceholder !== true) {\n        style = {\n          display: 'none'\n        };\n      } else if (renderPlaceholder) {\n        style = {\n          visibility: 'hidden',\n          // prevent from taking normal dom space\n          position: 'absolute'\n        };\n        key = key + '-placeholder';\n        eventKey = eventKey + '-placeholder';\n      }\n\n      var popupClassName = theme ? prefixCls + '-' + theme : '';\n      var props = {};\n      var on = {};\n      menuAllProps.props.forEach(function (k) {\n        if (rest[k] !== undefined) {\n          props[k] = rest[k];\n        }\n      });\n      menuAllProps.on.forEach(function (k) {\n        if (events[k] !== undefined) {\n          on[k] = events[k];\n        }\n      });\n      var subMenuProps = {\n        props: _extends({\n          title: overflowedIndicator,\n          popupClassName: popupClassName\n        }, props, {\n          eventKey: eventKey,\n          disabled: false\n        }),\n        'class': prefixCls + '-overflowed-submenu',\n        key: key,\n        style: style,\n        on: on\n      };\n      return h(SubMenu, subMenuProps, [overflowedItems]);\n    },\n    // memorize rendered menuSize\n    setChildrenWidthAndResize: function setChildrenWidthAndResize() {\n      if (this.mode !== 'horizontal') {\n        return;\n      }\n\n      var ul = this.$el;\n\n      if (!ul) {\n        return;\n      }\n\n      var ulChildrenNodes = ul.children;\n\n      if (!ulChildrenNodes || ulChildrenNodes.length === 0) {\n        return;\n      }\n\n      var lastOverflowedIndicatorPlaceholder = ul.children[ulChildrenNodes.length - 1]; // need last overflowed indicator for calculating length;\n\n      setStyle(lastOverflowedIndicatorPlaceholder, 'display', 'inline-block');\n      var menuItemNodes = this.getMenuItemNodes(); // reset display attribute for all hidden elements caused by overflow to calculate updated width\n      // and then reset to original state after width calculation\n\n      var overflowedItems = menuItemNodes.filter(function (c) {\n        return c.className.split(' ').indexOf(MENUITEM_OVERFLOWED_CLASSNAME) >= 0;\n      });\n      overflowedItems.forEach(function (c) {\n        setStyle(c, 'display', 'inline-block');\n      });\n      this.menuItemSizes = menuItemNodes.map(function (c) {\n        return getWidth(c);\n      });\n      overflowedItems.forEach(function (c) {\n        setStyle(c, 'display', 'none');\n      });\n      this.overflowedIndicatorWidth = getWidth(ul.children[ul.children.length - 1]);\n      this.originalTotalWidth = this.menuItemSizes.reduce(function (acc, cur) {\n        return acc + cur;\n      }, 0);\n      this.handleResize(); // prevent the overflowed indicator from taking space;\n\n      setStyle(lastOverflowedIndicatorPlaceholder, 'display', 'none');\n    },\n    handleResize: function handleResize() {\n      var _this2 = this;\n\n      if (this.mode !== 'horizontal') {\n        return;\n      }\n\n      var ul = this.$el;\n\n      if (!ul) {\n        return;\n      }\n\n      var width = getWidth(ul);\n      this.overflowedItems = [];\n      var currentSumWidth = 0; // index for last visible child in horizontal mode\n\n      var lastVisibleIndex = void 0; // float number comparison could be problematic\n      // e.g. 0.1 + 0.2 > 0.3 =====> true\n      // thus using FLOAT_PRECISION_ADJUST as buffer to help the situation\n\n      if (this.originalTotalWidth > width + FLOAT_PRECISION_ADJUST) {\n        lastVisibleIndex = -1;\n        this.menuItemSizes.forEach(function (liWidth) {\n          currentSumWidth += liWidth;\n\n          if (currentSumWidth + _this2.overflowedIndicatorWidth <= width) {\n            lastVisibleIndex += 1;\n          }\n        });\n      }\n\n      this.setState({\n        lastVisibleIndex: lastVisibleIndex\n      });\n    },\n    renderChildren: function renderChildren(children) {\n      var _this3 = this; // need to take care of overflowed items in horizontal mode\n\n\n      var lastVisibleIndex = this.$data.lastVisibleIndex;\n      var className = getClass(this);\n      return (children || []).reduce(function (acc, childNode, index) {\n        var item = childNode;\n        var eventKey = getPropsData(childNode).eventKey;\n\n        if (_this3.mode === 'horizontal') {\n          var overflowed = _this3.getOverflowedSubMenuItem(eventKey, []);\n\n          if (lastVisibleIndex !== undefined && className[_this3.prefixCls + '-root'] !== -1) {\n            if (index > lastVisibleIndex) {\n              item = cloneElement(childNode, // 这里修改 eventKey 是为了防止隐藏状态下还会触发 openkeys 事件\n              {\n                style: {\n                  display: 'none'\n                },\n                props: {\n                  eventKey: eventKey + '-hidden'\n                },\n                'class': MENUITEM_OVERFLOWED_CLASSNAME\n              });\n            }\n\n            if (index === lastVisibleIndex + 1) {\n              _this3.overflowedItems = children.slice(lastVisibleIndex + 1).map(function (c) {\n                return cloneElement(c, // children[index].key will become '.$key' in clone by default,\n                // we have to overwrite with the correct key explicitly\n                {\n                  key: getPropsData(c).eventKey,\n                  props: {\n                    mode: 'vertical-left'\n                  }\n                });\n              });\n              overflowed = _this3.getOverflowedSubMenuItem(eventKey, _this3.overflowedItems);\n            }\n          }\n\n          var ret = [].concat(_toConsumableArray(acc), [overflowed, item]);\n\n          if (index === children.length - 1) {\n            // need a placeholder for calculating overflowed indicator width\n            ret.push(_this3.getOverflowedSubMenuItem(eventKey, [], true));\n          }\n\n          return ret;\n        }\n\n        return [].concat(_toConsumableArray(acc), [item]);\n      }, []);\n    }\n  },\n  render: function render() {\n    var h = arguments[0];\n    var Tag = this.$props.tag;\n    var tagProps = {\n      on: getListeners(this)\n    };\n    return h(Tag, tagProps, [this.renderChildren(this.$slots['default'])]);\n  }\n};\nDOMWrap.props = {\n  mode: PropTypes.oneOf(['horizontal', 'vertical', 'vertical-left', 'vertical-right', 'inline']),\n  prefixCls: PropTypes.string,\n  level: PropTypes.number,\n  theme: PropTypes.string,\n  overflowedIndicator: PropTypes.node,\n  visible: PropTypes.bool,\n  hiddenClassName: PropTypes.string,\n  tag: PropTypes.string.def('div')\n};\nexport default DOMWrap;","map":{"version":3,"sources":["/Users/liulu/刘璐/vue3/hello-vue3/node_modules/ant-design-vue/es/vc-menu/DOMWrap.js"],"names":["_toConsumableArray","_extends","_objectWithoutProperties","PropTypes","ResizeObserver","SubMenu","BaseMixin","getWidth","setStyle","menuAllProps","cloneElement","getClass","getPropsData","getEvents","getListeners","canUseDOM","window","document","createElement","MENUITEM_OVERFLOWED_CLASSNAME","FLOAT_PRECISION_ADJUST","require","DOMWrap","name","mixins","data","resizeObserver","mutationObserver","originalTotalWidth","overflowedItems","menuItemSizes","lastVisibleIndex","undefined","mounted","_this","$nextTick","setChildrenWidthAndResize","level","mode","menuUl","$el","entries","forEach","slice","call","children","concat","el","observe","MutationObserver","disconnect","attributes","childList","subTree","beforeDestroy","methods","getMenuItemNodes","prefixCls","$props","ul","filter","node","className","split","indexOf","getOverflowedSubMenuItem","keyPrefix","renderPlaceholder","h","$createElement","_$props","overflowedIndicator","theme","copy","$slots","_getPropsData","title","rest","events","style","key","eventKey","length","display","visibility","position","popupClassName","props","on","k","subMenuProps","disabled","ulChildrenNodes","lastOverflowedIndicatorPlaceholder","menuItemNodes","c","map","overflowedIndicatorWidth","reduce","acc","cur","handleResize","_this2","width","currentSumWidth","liWidth","setState","renderChildren","_this3","$data","childNode","index","item","overflowed","ret","push","render","arguments","Tag","tag","tagProps","oneOf","string","number","visible","bool","hiddenClassName","def"],"mappings":"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","sourcesContent":["import _toConsumableArray from 'babel-runtime/helpers/toConsumableArray';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport PropTypes from '../_util/vue-types';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport SubMenu from './SubMenu';\nimport BaseMixin from '../_util/BaseMixin';\nimport { getWidth, setStyle, menuAllProps } from './util';\nimport { cloneElement } from '../_util/vnode';\nimport { getClass, getPropsData, getEvents, getListeners } from '../_util/props-util';\n\nvar canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);\n\nvar MENUITEM_OVERFLOWED_CLASSNAME = 'menuitem-overflowed';\nvar FLOAT_PRECISION_ADJUST = 0.5;\n\n// Fix ssr\nif (canUseDOM) {\n  require('mutationobserver-shim');\n}\n\nvar DOMWrap = {\n  name: 'DOMWrap',\n  mixins: [BaseMixin],\n  data: function data() {\n    this.resizeObserver = null;\n    this.mutationObserver = null;\n\n    // original scroll size of the list\n    this.originalTotalWidth = 0;\n\n    // copy of overflowed items\n    this.overflowedItems = [];\n\n    // cache item of the original items (so we can track the size and order)\n    this.menuItemSizes = [];\n    return {\n      lastVisibleIndex: undefined\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$nextTick(function () {\n      _this.setChildrenWidthAndResize();\n      if (_this.level === 1 && _this.mode === 'horizontal') {\n        var menuUl = _this.$el;\n        if (!menuUl) {\n          return;\n        }\n        _this.resizeObserver = new ResizeObserver(function (entries) {\n          entries.forEach(_this.setChildrenWidthAndResize);\n        });\n\n        [].slice.call(menuUl.children).concat(menuUl).forEach(function (el) {\n          _this.resizeObserver.observe(el);\n        });\n\n        if (typeof MutationObserver !== 'undefined') {\n          _this.mutationObserver = new MutationObserver(function () {\n            _this.resizeObserver.disconnect();\n            [].slice.call(menuUl.children).concat(menuUl).forEach(function (el) {\n              _this.resizeObserver.observe(el);\n            });\n            _this.setChildrenWidthAndResize();\n          });\n          _this.mutationObserver.observe(menuUl, {\n            attributes: false,\n            childList: true,\n            subTree: false\n          });\n        }\n      }\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n    if (this.mutationObserver) {\n      this.mutationObserver.disconnect();\n    }\n  },\n\n  methods: {\n    // get all valid menuItem nodes\n    getMenuItemNodes: function getMenuItemNodes() {\n      var prefixCls = this.$props.prefixCls;\n\n      var ul = this.$el;\n      if (!ul) {\n        return [];\n      }\n\n      // filter out all overflowed indicator placeholder\n      return [].slice.call(ul.children).filter(function (node) {\n        return node.className.split(' ').indexOf(prefixCls + '-overflowed-submenu') < 0;\n      });\n    },\n    getOverflowedSubMenuItem: function getOverflowedSubMenuItem(keyPrefix, overflowedItems, renderPlaceholder) {\n      var h = this.$createElement;\n      var _$props = this.$props,\n          overflowedIndicator = _$props.overflowedIndicator,\n          level = _$props.level,\n          mode = _$props.mode,\n          prefixCls = _$props.prefixCls,\n          theme = _$props.theme;\n\n      if (level !== 1 || mode !== 'horizontal') {\n        return null;\n      }\n      // put all the overflowed item inside a submenu\n      // with a title of overflow indicator ('...')\n      var copy = this.$slots['default'][0];\n\n      var _getPropsData = getPropsData(copy),\n          title = _getPropsData.title,\n          rest = _objectWithoutProperties(_getPropsData, ['title']); // eslint-disable-line no-unused-vars\n\n\n      var events = getEvents(copy);\n      var style = {};\n      var key = keyPrefix + '-overflowed-indicator';\n      var eventKey = keyPrefix + '-overflowed-indicator';\n\n      if (overflowedItems.length === 0 && renderPlaceholder !== true) {\n        style = {\n          display: 'none'\n        };\n      } else if (renderPlaceholder) {\n        style = {\n          visibility: 'hidden',\n          // prevent from taking normal dom space\n          position: 'absolute'\n        };\n        key = key + '-placeholder';\n        eventKey = eventKey + '-placeholder';\n      }\n\n      var popupClassName = theme ? prefixCls + '-' + theme : '';\n      var props = {};\n      var on = {};\n      menuAllProps.props.forEach(function (k) {\n        if (rest[k] !== undefined) {\n          props[k] = rest[k];\n        }\n      });\n      menuAllProps.on.forEach(function (k) {\n        if (events[k] !== undefined) {\n          on[k] = events[k];\n        }\n      });\n      var subMenuProps = {\n        props: _extends({\n          title: overflowedIndicator,\n          popupClassName: popupClassName\n        }, props, {\n          eventKey: eventKey,\n          disabled: false\n        }),\n        'class': prefixCls + '-overflowed-submenu',\n        key: key,\n        style: style,\n        on: on\n      };\n\n      return h(\n        SubMenu,\n        subMenuProps,\n        [overflowedItems]\n      );\n    },\n\n\n    // memorize rendered menuSize\n    setChildrenWidthAndResize: function setChildrenWidthAndResize() {\n      if (this.mode !== 'horizontal') {\n        return;\n      }\n      var ul = this.$el;\n\n      if (!ul) {\n        return;\n      }\n\n      var ulChildrenNodes = ul.children;\n\n      if (!ulChildrenNodes || ulChildrenNodes.length === 0) {\n        return;\n      }\n\n      var lastOverflowedIndicatorPlaceholder = ul.children[ulChildrenNodes.length - 1];\n\n      // need last overflowed indicator for calculating length;\n      setStyle(lastOverflowedIndicatorPlaceholder, 'display', 'inline-block');\n\n      var menuItemNodes = this.getMenuItemNodes();\n\n      // reset display attribute for all hidden elements caused by overflow to calculate updated width\n      // and then reset to original state after width calculation\n\n      var overflowedItems = menuItemNodes.filter(function (c) {\n        return c.className.split(' ').indexOf(MENUITEM_OVERFLOWED_CLASSNAME) >= 0;\n      });\n\n      overflowedItems.forEach(function (c) {\n        setStyle(c, 'display', 'inline-block');\n      });\n\n      this.menuItemSizes = menuItemNodes.map(function (c) {\n        return getWidth(c);\n      });\n\n      overflowedItems.forEach(function (c) {\n        setStyle(c, 'display', 'none');\n      });\n      this.overflowedIndicatorWidth = getWidth(ul.children[ul.children.length - 1]);\n      this.originalTotalWidth = this.menuItemSizes.reduce(function (acc, cur) {\n        return acc + cur;\n      }, 0);\n      this.handleResize();\n      // prevent the overflowed indicator from taking space;\n      setStyle(lastOverflowedIndicatorPlaceholder, 'display', 'none');\n    },\n    handleResize: function handleResize() {\n      var _this2 = this;\n\n      if (this.mode !== 'horizontal') {\n        return;\n      }\n\n      var ul = this.$el;\n      if (!ul) {\n        return;\n      }\n      var width = getWidth(ul);\n\n      this.overflowedItems = [];\n      var currentSumWidth = 0;\n\n      // index for last visible child in horizontal mode\n      var lastVisibleIndex = void 0;\n\n      // float number comparison could be problematic\n      // e.g. 0.1 + 0.2 > 0.3 =====> true\n      // thus using FLOAT_PRECISION_ADJUST as buffer to help the situation\n      if (this.originalTotalWidth > width + FLOAT_PRECISION_ADJUST) {\n        lastVisibleIndex = -1;\n\n        this.menuItemSizes.forEach(function (liWidth) {\n          currentSumWidth += liWidth;\n          if (currentSumWidth + _this2.overflowedIndicatorWidth <= width) {\n            lastVisibleIndex += 1;\n          }\n        });\n      }\n\n      this.setState({ lastVisibleIndex: lastVisibleIndex });\n    },\n    renderChildren: function renderChildren(children) {\n      var _this3 = this;\n\n      // need to take care of overflowed items in horizontal mode\n      var lastVisibleIndex = this.$data.lastVisibleIndex;\n\n      var className = getClass(this);\n      return (children || []).reduce(function (acc, childNode, index) {\n        var item = childNode;\n        var eventKey = getPropsData(childNode).eventKey;\n        if (_this3.mode === 'horizontal') {\n          var overflowed = _this3.getOverflowedSubMenuItem(eventKey, []);\n          if (lastVisibleIndex !== undefined && className[_this3.prefixCls + '-root'] !== -1) {\n            if (index > lastVisibleIndex) {\n              item = cloneElement(childNode,\n              // 这里修改 eventKey 是为了防止隐藏状态下还会触发 openkeys 事件\n              {\n                style: { display: 'none' },\n                props: { eventKey: eventKey + '-hidden' },\n                'class': MENUITEM_OVERFLOWED_CLASSNAME\n              });\n            }\n            if (index === lastVisibleIndex + 1) {\n              _this3.overflowedItems = children.slice(lastVisibleIndex + 1).map(function (c) {\n                return cloneElement(c,\n                // children[index].key will become '.$key' in clone by default,\n                // we have to overwrite with the correct key explicitly\n                {\n                  key: getPropsData(c).eventKey,\n                  props: { mode: 'vertical-left' }\n                });\n              });\n\n              overflowed = _this3.getOverflowedSubMenuItem(eventKey, _this3.overflowedItems);\n            }\n          }\n\n          var ret = [].concat(_toConsumableArray(acc), [overflowed, item]);\n\n          if (index === children.length - 1) {\n            // need a placeholder for calculating overflowed indicator width\n            ret.push(_this3.getOverflowedSubMenuItem(eventKey, [], true));\n          }\n          return ret;\n        }\n        return [].concat(_toConsumableArray(acc), [item]);\n      }, []);\n    }\n  },\n\n  render: function render() {\n    var h = arguments[0];\n\n    var Tag = this.$props.tag;\n    var tagProps = {\n      on: getListeners(this)\n    };\n    return h(\n      Tag,\n      tagProps,\n      [this.renderChildren(this.$slots['default'])]\n    );\n  }\n};\n\nDOMWrap.props = {\n  mode: PropTypes.oneOf(['horizontal', 'vertical', 'vertical-left', 'vertical-right', 'inline']),\n  prefixCls: PropTypes.string,\n  level: PropTypes.number,\n  theme: PropTypes.string,\n  overflowedIndicator: PropTypes.node,\n  visible: PropTypes.bool,\n  hiddenClassName: PropTypes.string,\n  tag: PropTypes.string.def('div')\n};\n\nexport default DOMWrap;"]},"metadata":{},"sourceType":"module"}