{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport raf from 'raf';\nimport PropTypes from '../_util/vue-types';\nimport Menu from '../vc-menu';\nimport scrollIntoView from 'dom-scroll-into-view';\nimport { getSelectKeys, preventDefaultEvent } from './util';\nimport { cloneElement } from '../_util/vnode';\nimport BaseMixin from '../_util/BaseMixin';\nimport { getSlotOptions, getComponentFromProp, getListeners } from '../_util/props-util';\nexport default {\n  name: 'DropdownMenu',\n  mixins: [BaseMixin],\n  props: {\n    ariaId: PropTypes.string,\n    defaultActiveFirstOption: PropTypes.bool,\n    value: PropTypes.any,\n    dropdownMenuStyle: PropTypes.object,\n    multiple: PropTypes.bool,\n    // onPopupFocus: PropTypes.func,\n    // onPopupScroll: PropTypes.func,\n    // onMenuDeSelect: PropTypes.func,\n    // onMenuSelect: PropTypes.func,\n    prefixCls: PropTypes.string,\n    menuItems: PropTypes.any,\n    inputValue: PropTypes.string,\n    visible: PropTypes.bool,\n    backfillValue: PropTypes.any,\n    firstActiveValue: PropTypes.string,\n    menuItemSelectedIcon: PropTypes.any\n  },\n  watch: {\n    visible: function visible(val) {\n      var _this = this;\n\n      if (!val) {\n        this.lastVisible = val;\n      } else {\n        this.$nextTick(function () {\n          _this.scrollActiveItemToView();\n        });\n      }\n    }\n  },\n  created: function created() {\n    this.rafInstance = null;\n    this.lastInputValue = this.$props.inputValue;\n    this.lastVisible = false;\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    this.$nextTick(function () {\n      _this2.scrollActiveItemToView();\n    });\n    this.lastVisible = this.$props.visible;\n  },\n  updated: function updated() {\n    var props = this.$props; // if (!this.prevVisible && props.visible) {\n    //   this.$nextTick(() => {\n    //     this.scrollActiveItemToView();\n    //   });\n    // }\n\n    this.lastVisible = props.visible;\n    this.lastInputValue = props.inputValue;\n    this.prevVisible = this.visible;\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.rafInstance) {\n      raf.cancel(this.rafInstance);\n    }\n  },\n  methods: {\n    scrollActiveItemToView: function scrollActiveItemToView() {\n      var _this3 = this; // scroll into view\n\n\n      var itemComponent = this.firstActiveItem && this.firstActiveItem.$el;\n      var props = this.$props;\n      var value = props.value,\n          visible = props.visible,\n          firstActiveValue = props.firstActiveValue;\n\n      if (!itemComponent || !visible) {\n        return;\n      }\n\n      var scrollIntoViewOpts = {\n        onlyScrollIfNeeded: true\n      };\n\n      if ((!value || value.length === 0) && firstActiveValue) {\n        scrollIntoViewOpts.alignWithTop = true;\n      } // Delay to scroll since current frame item position is not ready when pre view is by filter\n      // https://github.com/ant-design/ant-design/issues/11268#issuecomment-406634462\n\n\n      this.rafInstance = raf(function () {\n        scrollIntoView(itemComponent, _this3.$refs.menuRef.$el, scrollIntoViewOpts);\n      });\n    },\n    renderMenu: function renderMenu() {\n      var _this4 = this;\n\n      var h = this.$createElement;\n      var props = this.$props;\n      var menuItems = props.menuItems,\n          defaultActiveFirstOption = props.defaultActiveFirstOption,\n          value = props.value,\n          prefixCls = props.prefixCls,\n          multiple = props.multiple,\n          inputValue = props.inputValue,\n          firstActiveValue = props.firstActiveValue,\n          dropdownMenuStyle = props.dropdownMenuStyle,\n          backfillValue = props.backfillValue,\n          visible = props.visible;\n      var menuItemSelectedIcon = getComponentFromProp(this, 'menuItemSelectedIcon');\n\n      var _getListeners = getListeners(this),\n          menuDeselect = _getListeners.menuDeselect,\n          menuSelect = _getListeners.menuSelect,\n          popupScroll = _getListeners.popupScroll;\n\n      if (menuItems && menuItems.length) {\n        var selectedKeys = getSelectKeys(menuItems, value);\n        var menuProps = {\n          props: {\n            multiple: multiple,\n            itemIcon: multiple ? menuItemSelectedIcon : null,\n            selectedKeys: selectedKeys,\n            prefixCls: prefixCls + '-menu'\n          },\n          on: {},\n          style: dropdownMenuStyle,\n          ref: 'menuRef',\n          attrs: {\n            role: 'listbox'\n          }\n        };\n\n        if (popupScroll) {\n          menuProps.on.scroll = popupScroll;\n        }\n\n        if (multiple) {\n          menuProps.on.deselect = menuDeselect;\n          menuProps.on.select = menuSelect;\n        } else {\n          menuProps.on.click = menuSelect;\n        }\n\n        var activeKeyProps = {};\n        var defaultActiveFirst = defaultActiveFirstOption;\n        var clonedMenuItems = menuItems;\n\n        if (selectedKeys.length || firstActiveValue) {\n          if (props.visible && !this.lastVisible) {\n            activeKeyProps.activeKey = selectedKeys[0] || firstActiveValue;\n          } else if (!visible) {\n            // Do not trigger auto active since we already have selectedKeys\n            if (selectedKeys[0]) {\n              defaultActiveFirst = false;\n            }\n\n            activeKeyProps.activeKey = undefined;\n          }\n\n          var foundFirst = false; // set firstActiveItem via cloning menus\n          // for scroll into view\n\n          var clone = function clone(item) {\n            if (!foundFirst && selectedKeys.indexOf(item.key) !== -1 || !foundFirst && !selectedKeys.length && firstActiveValue.indexOf(item.key) !== -1) {\n              foundFirst = true;\n              return cloneElement(item, {\n                directives: [{\n                  name: 'ant-ref',\n                  value: function value(ref) {\n                    _this4.firstActiveItem = ref;\n                  }\n                }]\n              });\n            }\n\n            return item;\n          };\n\n          clonedMenuItems = menuItems.map(function (item) {\n            if (getSlotOptions(item).isMenuItemGroup) {\n              var children = item.componentOptions.children.map(clone);\n              return cloneElement(item, {\n                children: children\n              });\n            }\n\n            return clone(item);\n          });\n        } else {\n          // Clear firstActiveItem when dropdown menu items was empty\n          // Avoid `Unable to find node on an unmounted component`\n          // https://github.com/ant-design/ant-design/issues/10774\n          this.firstActiveItem = null;\n        } // clear activeKey when inputValue change\n\n\n        var lastValue = value && value[value.length - 1];\n\n        if (inputValue !== this.lastInputValue && (!lastValue || lastValue !== backfillValue)) {\n          activeKeyProps.activeKey = '';\n        }\n\n        menuProps.props = _extends({}, activeKeyProps, menuProps.props, {\n          defaultActiveFirst: defaultActiveFirst\n        });\n        return h(Menu, menuProps, [clonedMenuItems]);\n      }\n\n      return null;\n    }\n  },\n  render: function render() {\n    var h = arguments[0];\n    var renderMenu = this.renderMenu();\n\n    var _getListeners2 = getListeners(this),\n        popupFocus = _getListeners2.popupFocus,\n        popupScroll = _getListeners2.popupScroll;\n\n    return renderMenu ? h('div', {\n      style: {\n        overflow: 'auto',\n        transform: 'translateZ(0)'\n      },\n      attrs: {\n        id: this.$props.ariaId,\n        tabIndex: '-1'\n      },\n      on: {\n        'focus': popupFocus,\n        'mousedown': preventDefaultEvent,\n        'scroll': popupScroll\n      },\n      ref: 'menuContainer'\n    }, [renderMenu]) : null;\n  }\n};","map":{"version":3,"sources":["/Users/liulu/刘璐/vue3/hello-vue3/node_modules/ant-design-vue/es/vc-select/DropdownMenu.js"],"names":["_extends","raf","PropTypes","Menu","scrollIntoView","getSelectKeys","preventDefaultEvent","cloneElement","BaseMixin","getSlotOptions","getComponentFromProp","getListeners","name","mixins","props","ariaId","string","defaultActiveFirstOption","bool","value","any","dropdownMenuStyle","object","multiple","prefixCls","menuItems","inputValue","visible","backfillValue","firstActiveValue","menuItemSelectedIcon","watch","val","_this","lastVisible","$nextTick","scrollActiveItemToView","created","rafInstance","lastInputValue","$props","mounted","_this2","updated","prevVisible","beforeDestroy","cancel","methods","_this3","itemComponent","firstActiveItem","$el","scrollIntoViewOpts","onlyScrollIfNeeded","length","alignWithTop","$refs","menuRef","renderMenu","_this4","h","$createElement","_getListeners","menuDeselect","menuSelect","popupScroll","selectedKeys","menuProps","itemIcon","on","style","ref","attrs","role","scroll","deselect","select","click","activeKeyProps","defaultActiveFirst","clonedMenuItems","activeKey","undefined","foundFirst","clone","item","indexOf","key","directives","map","isMenuItemGroup","children","componentOptions","lastValue","render","arguments","_getListeners2","popupFocus","overflow","transform","id","tabIndex"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport raf from 'raf';\nimport PropTypes from '../_util/vue-types';\nimport Menu from '../vc-menu';\nimport scrollIntoView from 'dom-scroll-into-view';\nimport { getSelectKeys, preventDefaultEvent } from './util';\nimport { cloneElement } from '../_util/vnode';\nimport BaseMixin from '../_util/BaseMixin';\nimport { getSlotOptions, getComponentFromProp, getListeners } from '../_util/props-util';\n\nexport default {\n  name: 'DropdownMenu',\n  mixins: [BaseMixin],\n  props: {\n    ariaId: PropTypes.string,\n    defaultActiveFirstOption: PropTypes.bool,\n    value: PropTypes.any,\n    dropdownMenuStyle: PropTypes.object,\n    multiple: PropTypes.bool,\n    // onPopupFocus: PropTypes.func,\n    // onPopupScroll: PropTypes.func,\n    // onMenuDeSelect: PropTypes.func,\n    // onMenuSelect: PropTypes.func,\n    prefixCls: PropTypes.string,\n    menuItems: PropTypes.any,\n    inputValue: PropTypes.string,\n    visible: PropTypes.bool,\n    backfillValue: PropTypes.any,\n    firstActiveValue: PropTypes.string,\n    menuItemSelectedIcon: PropTypes.any\n  },\n  watch: {\n    visible: function visible(val) {\n      var _this = this;\n\n      if (!val) {\n        this.lastVisible = val;\n      } else {\n        this.$nextTick(function () {\n          _this.scrollActiveItemToView();\n        });\n      }\n    }\n  },\n\n  created: function created() {\n    this.rafInstance = null;\n    this.lastInputValue = this.$props.inputValue;\n    this.lastVisible = false;\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    this.$nextTick(function () {\n      _this2.scrollActiveItemToView();\n    });\n    this.lastVisible = this.$props.visible;\n  },\n  updated: function updated() {\n    var props = this.$props;\n    // if (!this.prevVisible && props.visible) {\n    //   this.$nextTick(() => {\n    //     this.scrollActiveItemToView();\n    //   });\n    // }\n    this.lastVisible = props.visible;\n    this.lastInputValue = props.inputValue;\n    this.prevVisible = this.visible;\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.rafInstance) {\n      raf.cancel(this.rafInstance);\n    }\n  },\n\n  methods: {\n    scrollActiveItemToView: function scrollActiveItemToView() {\n      var _this3 = this;\n\n      // scroll into view\n      var itemComponent = this.firstActiveItem && this.firstActiveItem.$el;\n      var props = this.$props;\n      var value = props.value,\n          visible = props.visible,\n          firstActiveValue = props.firstActiveValue;\n\n      if (!itemComponent || !visible) {\n        return;\n      }\n      var scrollIntoViewOpts = {\n        onlyScrollIfNeeded: true\n      };\n      if ((!value || value.length === 0) && firstActiveValue) {\n        scrollIntoViewOpts.alignWithTop = true;\n      }\n      // Delay to scroll since current frame item position is not ready when pre view is by filter\n      // https://github.com/ant-design/ant-design/issues/11268#issuecomment-406634462\n      this.rafInstance = raf(function () {\n        scrollIntoView(itemComponent, _this3.$refs.menuRef.$el, scrollIntoViewOpts);\n      });\n    },\n    renderMenu: function renderMenu() {\n      var _this4 = this;\n\n      var h = this.$createElement;\n\n      var props = this.$props;\n      var menuItems = props.menuItems,\n          defaultActiveFirstOption = props.defaultActiveFirstOption,\n          value = props.value,\n          prefixCls = props.prefixCls,\n          multiple = props.multiple,\n          inputValue = props.inputValue,\n          firstActiveValue = props.firstActiveValue,\n          dropdownMenuStyle = props.dropdownMenuStyle,\n          backfillValue = props.backfillValue,\n          visible = props.visible;\n\n      var menuItemSelectedIcon = getComponentFromProp(this, 'menuItemSelectedIcon');\n\n      var _getListeners = getListeners(this),\n          menuDeselect = _getListeners.menuDeselect,\n          menuSelect = _getListeners.menuSelect,\n          popupScroll = _getListeners.popupScroll;\n\n      if (menuItems && menuItems.length) {\n        var selectedKeys = getSelectKeys(menuItems, value);\n        var menuProps = {\n          props: {\n            multiple: multiple,\n            itemIcon: multiple ? menuItemSelectedIcon : null,\n            selectedKeys: selectedKeys,\n            prefixCls: prefixCls + '-menu'\n          },\n          on: {},\n          style: dropdownMenuStyle,\n          ref: 'menuRef',\n          attrs: {\n            role: 'listbox'\n          }\n        };\n        if (popupScroll) {\n          menuProps.on.scroll = popupScroll;\n        }\n        if (multiple) {\n          menuProps.on.deselect = menuDeselect;\n          menuProps.on.select = menuSelect;\n        } else {\n          menuProps.on.click = menuSelect;\n        }\n        var activeKeyProps = {};\n\n        var defaultActiveFirst = defaultActiveFirstOption;\n        var clonedMenuItems = menuItems;\n        if (selectedKeys.length || firstActiveValue) {\n          if (props.visible && !this.lastVisible) {\n            activeKeyProps.activeKey = selectedKeys[0] || firstActiveValue;\n          } else if (!visible) {\n            // Do not trigger auto active since we already have selectedKeys\n            if (selectedKeys[0]) {\n              defaultActiveFirst = false;\n            }\n            activeKeyProps.activeKey = undefined;\n          }\n          var foundFirst = false;\n          // set firstActiveItem via cloning menus\n          // for scroll into view\n          var clone = function clone(item) {\n            if (!foundFirst && selectedKeys.indexOf(item.key) !== -1 || !foundFirst && !selectedKeys.length && firstActiveValue.indexOf(item.key) !== -1) {\n              foundFirst = true;\n              return cloneElement(item, {\n                directives: [{\n                  name: 'ant-ref',\n                  value: function value(ref) {\n                    _this4.firstActiveItem = ref;\n                  }\n                }]\n              });\n            }\n            return item;\n          };\n\n          clonedMenuItems = menuItems.map(function (item) {\n            if (getSlotOptions(item).isMenuItemGroup) {\n              var children = item.componentOptions.children.map(clone);\n              return cloneElement(item, { children: children });\n            }\n            return clone(item);\n          });\n        } else {\n          // Clear firstActiveItem when dropdown menu items was empty\n          // Avoid `Unable to find node on an unmounted component`\n          // https://github.com/ant-design/ant-design/issues/10774\n          this.firstActiveItem = null;\n        }\n\n        // clear activeKey when inputValue change\n        var lastValue = value && value[value.length - 1];\n        if (inputValue !== this.lastInputValue && (!lastValue || lastValue !== backfillValue)) {\n          activeKeyProps.activeKey = '';\n        }\n        menuProps.props = _extends({}, activeKeyProps, menuProps.props, { defaultActiveFirst: defaultActiveFirst });\n        return h(\n          Menu,\n          menuProps,\n          [clonedMenuItems]\n        );\n      }\n      return null;\n    }\n  },\n  render: function render() {\n    var h = arguments[0];\n\n    var renderMenu = this.renderMenu();\n\n    var _getListeners2 = getListeners(this),\n        popupFocus = _getListeners2.popupFocus,\n        popupScroll = _getListeners2.popupScroll;\n\n    return renderMenu ? h(\n      'div',\n      {\n        style: {\n          overflow: 'auto',\n          transform: 'translateZ(0)'\n        },\n        attrs: { id: this.$props.ariaId,\n          tabIndex: '-1'\n        },\n        on: {\n          'focus': popupFocus,\n          'mousedown': preventDefaultEvent,\n          'scroll': popupScroll\n        },\n\n        ref: 'menuContainer'\n      },\n      [renderMenu]\n    ) : null;\n  }\n};"]},"metadata":{},"sourceType":"module"}